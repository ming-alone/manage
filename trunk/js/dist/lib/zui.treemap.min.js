!function(e,t){"object"==typeof exports?module.exports=t():"function"==typeof define&&(define.amd||define.cmd)?define("lib/zui.treemap.min",[],t):e.eventUtil=t()}(this,function(){!function(w,e,t,b,o){"use strict";var x="zui.treemap",i={data:[],cableWidth:1,cableColor:"#808080",cableStyle:"solid",rowSpace:30,nodeSpace:20,listenNodeResize:!0,nodeTemplate:'<div class="treemap-node"><a class="treemap-node-wrapper"></a></div>',foldable:!0,clickNodeToFold:!0},d=function(e){return e.children("li,.treemap-data-item").map(function(){var e=w(this),t=e.data(),o=e.children(".text"),a=e.children(".content"),n=e.children("ul,.treemap-data-list");if(o.length&&(t.text=o.text()),a.length&&(t.html=a.html()),n.length&&(t.children=d(n)),!t.text&&!t.html){var r=e.children(":not(ul,.treemap-data-list)"),l=e.clone();l.find("ul,.treemap-data-list").remove(),r.length?t.html=l.html():t.text=l.text()}return t}).get()},l=function(e,t){var o=w(e);w.isArray(t)&&(t={data:t});var a=(t=w.extend({},i,o.data(),t)).data||[];if(!a.length){var n=o.children(".treemap-data");n.length&&(a=d(n.hide()))}var r=o.children(".treemap-nodes");r.length||(r=w('<div class="treemap-nodes" unselectable="on"/>').appendTo(o));var l=this;l.$=o,l.$nodes=r,l.data=w.isArray(a)?a:[a],l.options=t,l.offsetX=0,l.offsetY=0,l.scale=t.scale||1,l.render(),r.on("resize",".treemap-node-wrapper",function(){l.delayDrawLines()}),t.foldable&&r.on("click",t.clickNodeToFold?".treemap-node-wrapper":".treemap-node-fold-icon",function(){l.toggle(w(this).closest(".treemap-node"))}),r.on("click",".treemap-node-wrapper",function(){var e=w(this).closest(".treemap-node");l.callEvent("onNodeClick",e.data("node"))})};l.prototype.toggle=function(e,t,o){var a=this;if("boolean"==typeof e&&(t=e,e=null),e||(e=a.$nodes.children(".treemap-node").first()),e){if(!1===e.data("node").foldable)return;void 0===t&&(t=e.hasClass("collapsed")),e.toggleClass("collapsed",!t).find('[data-toggle="tooltip"]').tooltip("hide"),o||e.addClass("tree-node-collapsing"),a.$nodes.find(".tooltip").remove(),a.drawLines(),o?(clearTimeout(a.toggleTimeTask),a.toggleTimeTask=setTimeout(function(){e.removeClass("tree-node-collapsing")},200)):e.removeClass("tree-node-collapsing")}},l.prototype.showLevel=function(t){var o=this;o.$nodes.find(".treemap-node").each(function(){var e=w(this);o.toggle(e,e.data("level")<t,!0)})},l.prototype.render=function(e){var t=this;t.data=e?w.isArray(e)?e:[e]:t.data,t.data&&(t.createNodes(),t.drawLines(),t.delayDrawLines(500)),t.callEvent("afterRender")},l.prototype.createNodes=function(c,h,f){var m=this,u=m.options,g=u.rowSpace,v=m.$nodes;h||(v.find(".treemap-node-wrapper").off("resize."+x),v.empty()),u.sort&&c.sort(w.isFunction(u.sort)?u.sort:function(e,t){return(e.order||0)-t.order});var y=null;c=c||m.data,h||(m.maxLevel=1),w.each(c,function(e,t){"string"==typeof t&&(t={html:t},c[e]=t),t.id||(t.id=w.zui.uuid()),t.level=h?h.level+1:1,m.maxLevel=b.max(m.maxLevel,t.level);var o=w.isFunction(u.nodeTemplate),a=o?u.nodeTemplate(t,m):w(u.nodeTemplate),n=a.find(".treemap-node-wrapper");n.length||(n=w('<div class="treemap-node-wrapper"/>').appendTo(a));var r=t.children,l=r&&r.length;t.isOnlyOneChild=1===l,t.idx=e;var i=h?h.row+1:0;a.toggleClass("treemap-node-has-child",!!l).toggleClass("treemap-node-has-parent",!!h).toggleClass("treemap-node-one-child",1===l).toggleClass("collapsed",!!t.collapsed&&"false"!==t.collapsed).toggleClass("treemap-node-root",!i).attr({"data-id":t.id,"data-level":t.level}).data("node",t),t.className&&a.addClass(t.className),t.row=i;var d=w.extend({},u.nodeStyle,t.style);t.textColor&&(d.color=t.textColor),t.color&&(d.backgroundColor=t.color),t.border&&(d.border=t.border);var s=w.extend({},t.attrs,{title:t.caption});if(t.tooltip&&(s["data-toggle"]="tooltip",s.title=t.tooltip),n.attr(s).css(d),y&&a.css("padding-left",u.nodeSpace),o||(t.html?n.append(t.html):t.text&&n.text(t.text)),a.appendTo(h?h.$children:v),y&&(y.next=t),t.prev=y,t.parent=h,t.$=a,t.$wrapper=n,l){var p=a.find(".treemap-node-children");p.length||(p=w('<div class="treemap-node-children"/>').appendTo(a)),p.css("margin-top",g),t.$children=p,m.createNodes(r,t)}u.listenNodeResize&&n.on("resize."+x,function(){m.delayDrawLines()}),y=t,f&&f(a,t)}),h||v.find('[data-toggle="tooltip"]').tooltip(u.tooltip)},l.prototype.delayDrawLines=function(e){var t=this;clearTimeout(t.delayDrawLinesTask),t.delayDrawLinesTask=setTimeout(function(){t.drawLines()},e||10)},l.prototype.drawLines=function(e,c){var h=this,f=h.options,m=f.rowSpace,u={};f.cableWidth&&(u.borderWidth=f.cableWidth),f.cableStyle&&(u.borderStyle=f.cableStyle),f.cableColor&&(u.borderColor=f.cableColor);var g=b.round(m/2),v=h.$nodes.offset().left;w.each(e||h.data,function(e,t){var o=t.$wrapper,a=t.children,n=w.extend({height:g,top:-g-1,left:b.round((o.outerWidth()-u.borderWidth)/2),color:u.borderColor},u);if(c&&!c.isOnlyOneChild){var r=o.find(".treemap-line-top");r.length||(r=w('<div class="treemap-line-top"/>').appendTo(o)),r.css(n)}if(a&&a.length){n.top=o.outerHeight()-1,t.isOnlyOneChild&&(n.height=m);var l=o.find(".treemap-line-bottom");if(l.length||(l=w('<div class="treemap-line-bottom"/>').appendTo(o),f.foldable&&l.append('<i class="treemap-node-fold-icon icon" style="transform: translate(-'+b.floor(n.borderWidth/2)+"px, "+g+'px)"/>')),l.css(n),h.drawLines(a,t),1<a.length){var i=a[0],d=a[a.length-1],s=t.$.children(".treemap-line");s.length||(s=w('<div class="treemap-line"/>').insertAfter(o));var p=b.round(i.$wrapper.offset().left-v+i.$wrapper.outerWidth()/2);s.css(w.extend({marginTop:g,left:p,width:d.$wrapper.offset().left-v-p+d.$wrapper.outerWidth()/2},u))}}}),c||h.callEvent("afterDrawLines")},l.prototype.callEvent=function(e,t){if(w.isArray(t)||(t=[t]),this.$.trigger(e,t),w.isFunction(this.options[e]))return this.options[e].apply(this,t)},l.DEFAULTS=i,l.NAME=x,w.fn.treemap=function(a,n,r){return this.each(function(){var e=w(this),t=e.data(x),o="object"==typeof a&&a;t||e.data(x,t=new l(this,o)),"string"==typeof a&&t[a](n,r)})},w.fn.treemap.Constructor=l}(jQuery,window,document,Math)});