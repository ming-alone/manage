define("admin/admin_list",["jquery","zui","lib/zui.datagrid.min","lib/chosen.min","config/config","config/function"],function(require,exports,module){"use strict";var a=require("jquery");require("zui"),require("lib/zui.datagrid.min"),require("lib/chosen.min");var o=require("config/config"),r=require("config/function"),e={init:function(){t(),s(),p(),f(),v(),y(),I(),S(),k(),R()}},t=function(){n(1e3,i)},n=function(e,i){var s={page:1,rows:e=e||0};a.ajax({type:"GET",url:o.REQUEST_URL.ADMIN_LIST,dataType:"json",data:s,xhrFields:{withCredentials:!0},crossDomain:!0,success:function(e){if(e.records&&e.records>s.rows){var t=s.rows+=1e3;return n(t,i),!1}if(null==e.rows||""==e.rows)r.show_error_tip("沒有資料"),a.isFunction(i)&&i(e);else if(a.isFunction(i)){r.show_chosen([{key:"UserId",value:"ID"},{key:"GroupName",value:"組名"},{key:"UserName",value:"使用者名稱"},{key:"WxUserId",value:"微信ID"},{key:"Status",value:"狀態"}]),i(e)}}})},l=function(e,i){var s={page:1,rows:e=e||0};a.ajax({type:"GET",url:o.REQUEST_URL.ADMIN_LIST,dataType:"json",data:s,xhrFields:{withCredentials:!0},crossDomain:!0,success:function(e){if(e.records&&e.records>s.rows){var t=s.rows+=1e3;return l(t,i),!1}a.isFunction(i)&&i(c(e))}})},c=function(e){for(var t=e.rows||[],i=[],s=0;s<t.length;s++){var o=1==t[s].cell.Status?"正常":"鎖定",a=""==t[s].cell.WxUserId||null==t[s].cell.WxUserId?"繫結":"解绑",r=""==t[s].cell.WxUserId||null==t[s].cell.WxUserId?"bind":"unbind",n=""==t[s].cell.WxUserId||null==t[s].cell.WxUserId?"/admin/wx_bind":"/admin/wx_unbind",l={GroupName:t[s].cell.GroupName,UserName:t[s].cell.UserName,WxUserId:null==t[s].cell.WxUserId?"":t[s].cell.WxUserId,Status:o,option:'<div class="btn-group"><a data-id='+t[s].cell.UserId+' href="/admin/admin_edit" class="power btn edit">編輯</a><a data-id='+t[s].cell.UserId+' href="/admin/admin_delete" class="power btn del">刪除</a><a data-id='+t[s].cell.UserId+" href="+n+' class="power btn '+r+'">'+a+"</a></div>"};i.push(l)}return i},i=function(e){var t=c(e);a("#datagridPageExample").datagrid({dataSource:{cols:[{name:"GroupName",label:"組名"},{name:"UserName",label:"使用者名稱"},{name:"WxUserId",label:"微信ID"},{name:"Status",label:"狀態"},{name:"option",label:"操作",html:!0}],array:t},states:{pager:{page:1,recPerPage:14}},configs:{R0C0:{label:'<div id="checkAll" class="checkbox-primary datagrid-checkbox"><label></label></div>',html:!0},C0:{label:'<div class="che checkbox-primary datagrid-checkbox"><label></label></div>',width:"38px",html:!0}},sortable:!0,height:"page"}),a("#datagridPageExample").on("onRender",function(e){a(".datagrid-row-cell").removeClass("active")})},s=function(){a(document).on("click",'[data-link="/admin/admin_add"]',function(){d(h,r.show_error_tip)})},d=function(t,i){a.ajax({type:"GET",url:o.REQUEST_URL.GET_GROUP_LIST,dataType:"json",xhrFields:{withCredentials:!0},crossDomain:!0,success:function(e){!0===e.status?a.isFunction(t)&&t(e):a.isFunction(i)&&i(e.info)}})},h=function(e){new a.zui.ModalTrigger({width:"auto",height:"auto",className:"in_auto",title:"新增管理員",custom:'<div id="datagridModel" class="datagrid"><div class="input-control search-box search-box-circle has-icon-left has-icon-right" id="searchboxExample" style="margin-bottom: 10px; max-width: 300px"><input id="inputSearchExample" type="search" class="form-control search-input" placeholder="搜尋"><label for="inputSearchExample" class="input-control-icon-left search-icon"><i class="icon icon-search"></i></label><a href="#" class="input-control-icon-right search-clear-btn"><i class="icon icon-remove"></i></a></div><div class="datagrid-container"></div><div class="pager"></div></div><div class="input-control has-label-left-lg"><input id="adminNameInput" type="text" class="form-control" placeholder=""><label for="adminNameInput" class="input-control-label-left text-right">管理員姓名</label></div><div class="input-control has-label-left-lg"><input id="groupIdInput" type="text" class="form-control" placeholder=""><label for="groupIdInput" class="input-control-label-left text-right">組ID</label></div><div class="switch"><input id="adminCheckInput" type="checkbox"><label>鎖定</label></div><button id="adminAddButton" class="btn btn-block btn-primary disabled up" type="button">新增</button>',backdrop:"static"}).show(),u(e)},u=function(e){for(var t=e.data,i=[],s=0;s<t.length;s++){var o={Id:t[s].Id,GroupName:t[s].GroupName,GroupInfo:t[s].GroupInfo};i.push(o)}a("#datagridModel").datagrid({dataSource:{cols:[{name:"Id",label:"管理員組ID"},{name:"GroupName",label:"管理員組名稱"},{name:"GroupInfo",label:"組描述"}],array:i},states:{pager:{page:1,recPerPage:5}},showRowIndex:!1,sortable:!0,height:"page"})},p=function(){a(document).on("click","#adminAddButton",function(){a("#adminAddButton").addClass("disabled"),_(r.show_success_tip,r.show_error_tip)})},_=function(t,i){var e={userName:a("#adminNameInput").val(),groupId:a("#groupIdInput").val(),status:1==a("#adminCheckInput").prop("checked")?0:1};a("#adminCheckInput").addClass("disabled"),a.ajax({type:"POST",url:o.REQUEST_URL.ADMIN_ADD,dataType:"json",data:e,xhrFields:{withCredentials:!0},crossDomain:!0,success:function(e){!0===e.status?(a.isFunction(t)&&t(e.info),a("#triggerModal").modal("hide"),l(1e3,r.change_page)):(a.isFunction(i)&&i(e.info),a("#adminAddButton").removeClass("disabled"))}})},f=function(){a(document).on("click",".edit",function(e){e.stopPropagation();var t=a(this).attr("data-id");g(t,m,r.show_error_tip)})},g=function(e,t,i){var s={adminId:e};a.ajax({type:"GET",url:o.REQUEST_URL.GET_ADMIN_INFO,dataType:"json",data:s,xhrFields:{withCredentials:!0},crossDomain:!0,success:function(e){!0===e.status?(a.isFunction(t)&&t(e),d(u)):a.isFunction(i)&&i(e.info)}})},m=function(e){var t=e.data,i=0==t.Status?"checked":"",s='<div id="datagridModel" class="datagrid"><div class="input-control search-box search-box-circle has-icon-left has-icon-right" id="searchboxExample" style="margin-bottom: 10px; max-width: 300px"><input id="inputSearchExample" type="search" class="form-control search-input" placeholder="搜尋"><label for="inputSearchExample" class="input-control-icon-left search-icon"><i class="icon icon-search"></i></label><a href="#" class="input-control-icon-right search-clear-btn"><i class="icon icon-remove"></i></a></div><div class="datagrid-container"></div><div class="pager"></div></div><div class="input-control has-label-left-lg"><input id="adminNameInput" type="text" class="form-control" value='+t.UserName+' placeholder=""><label for="adminNameInput" class="input-control-label-left text-right">管理員姓名</label></div><div class="input-control has-label-left-lg"><input id="groupIdInput" type="text" class="form-control" value='+t.GroupId+' placeholder=""><label for="groupIdInput" class="input-control-label-left text-right">組ID</label></div><div class="switch"><input id="adminCheckInput" type="checkbox" '+i+'><label>鎖定</label></div><button id="adminEditButton" data-id='+t.UserId+' class="btn btn-block btn-primary up" type="button">儲存</button>';new a.zui.ModalTrigger({width:"auto",height:"auto",className:"in_auto",title:"編輯管理員",custom:s,backdrop:"static"}).show()},v=function(){a(document).on("click","#adminEditButton",function(){a("#adminEditButton").addClass("disabled");var e=a(this).attr("data-id");b(e,r.show_success_tip,r.show_error_tip)})},b=function(e,t,i){var s={adminId:e,userName:a("#adminNameInput").val(),groupId:a("#groupIdInput").val(),status:1==a("#adminCheckInput").prop("checked")?0:1};a.ajax({type:"POST",url:o.REQUEST_URL.ADMIN_EDIT,dataType:"json",data:s,xhrFields:{withCredentials:!0},crossDomain:!0,success:function(e){!0===e.status?(a.isFunction(t)&&t(e.info),a("#triggerModal").modal("hide"),l(1e3,r.change_page)):(a.isFunction(i)&&i(e.info),a("#adminEditButton").removeClass("disabled"))}})},y=function(){a(document).on("click",".del",function(e){e.stopPropagation();var t=a(this).attr("data-id");x(t)}),w()},w=function(){a(document).on("click","#confirm",function(){a("#confirm").addClass("disabled");var e=a(this).attr("data-id");C(e,r.show_success_tip,r.show_error_tip)}),a(document).on("click","#cancel",function(){a("#triggerModal").modal("hide")})},x=function(e){var t='<h4>確認要刪除嗎?</h4><hr/><button type="button" data-id='+e+' id="confirm" class="btn btn-block btn-primary">確定</button><button type="button" id="cancel" class="btn btn-block btn-primary">取消</button>';new a.zui.ModalTrigger({width:"300px",height:"auto",className:"in_auto",title:"刪除管理員",custom:t,backdrop:"static"}).show()},C=function(e,t,i){var s={idString:e};a.ajax({type:"GET",url:o.REQUEST_URL.ADMIN_DELETE,dataType:"json",data:s,xhrFields:{withCredentials:!0},crossDomain:!0,success:function(e){!0===e.status?(a.isFunction(t)&&t(e.info),a("#triggerModal").modal("hide"),l(1e3,r.change_page)):(a.isFunction(i)&&i(e.info),a("#triggerModal").modal("hide"))}})},k=function(){a(document).on("click",'[data-link="/admin/admin_delete"]:not(".del")',function(e){T()}),a(document).on("click","#continue",function(){a("#continue").addClass("disabled");for(var e=a(".che.checked").parents(".datagrid-row").find(".del"),t=[],i=0;i<e.length;i++)t.push(parseInt(e[i].getAttribute("data-id")));C(t.toString(),r.show_success_tip,r.show_error_tip)}),a(document).on("click","#cancel",function(e){a("#triggerModal").modal("hide")})},T=function(){new a.zui.ModalTrigger({width:"300px",height:"auto",className:"in_auto",title:"刪除管理員",custom:'<h4>確認要刪除所選的管理員嗎?</h4><hr/><button type="button" id="continue" class="btn btn-block btn-primary">確定</button><button type="button" id="cancel" class="btn btn-block btn-primary">取消</button>',backdrop:"static"}).show()},I=function(){a(document).on("click",".bind",function(e){e.stopPropagation();var t='<div class="input-control has-label-left-lg"><input id="address" type="text" class="form-control" value='+("/bind.html?adminId="+a(this).attr("data-id"))+' placeholder=""><label for="address" class="input-control-label-left text-right">繫結地址</label></div>';new a.zui.ModalTrigger({width:"auto",height:"auto",className:"in_auto",title:"管理員微信繫結",custom:t,backdrop:"static"}).show()})},S=function(){a(document).on("click",".unbind",function(e){e.stopPropagation();var t=a(this).attr("data-id");M(t)}),D()},D=function(){a(document).on("click","#unbind",function(){a("#unbind").addClass("disabled");var e=a(this).attr("data-id");E(e,r.show_success_tip,r.show_error_tip)}),a(document).on("click","#cancel",function(){a("#triggerModal").modal("hide")})},E=function(e,t,i){var s={adminId:e};a.ajax({type:"GET",url:o.REQUEST_URL.ADMIN_WX_UNBIND,dataType:"json",data:s,xhrFields:{withCredentials:!0},crossDomain:!0,success:function(e){!0===e.status?(a.isFunction(t)&&t(e.info),a("#triggerModal").modal("hide"),l(1e3,r.change_page)):(a.isFunction(i)&&i(e.info),a("#triggerModal").modal("hide"))}})},M=function(e){var t='<h4>確認要解除繫結嗎?</h4><hr/><button type="button" data-id='+e+' id="unbind" class="btn btn-block btn-primary">確定</button><button type="button" id="cancel" class="btn btn-block btn-primary">取消</button>';new a.zui.ModalTrigger({width:"300px",height:"auto",className:"in_auto",title:"管理員微信解綁",custom:t,backdrop:"static"}).show()},R=function(){a(document).on("click",".search-button",function(){r.search_data(o.REQUEST_URL.ADMIN_LIST,1e3,c)})};module.exports=e}),function(e,t){"object"==typeof exports?module.exports=t():"function"==typeof define&&(define.amd||define.cmd)?define("lib/zui.datagrid.min",[],t):e.eventUtil=t()}(this,function(){var e;e=function(u){function t(e){var t=e||window.event,i=m.call(arguments,1),s=0,o=0,a=0,r=0,n=0,l=0;if((e=u.event.fix(t)).type="mousewheel","detail"in t&&(a=-1*t.detail),"wheelDelta"in t&&(a=t.wheelDelta),"wheelDeltaY"in t&&(a=t.wheelDeltaY),"wheelDeltaX"in t&&(o=-1*t.wheelDeltaX),"axis"in t&&t.axis===t.HORIZONTAL_AXIS&&(o=-1*a,a=0),s=0===a?o:a,"deltaY"in t&&(s=a=-1*t.deltaY),"deltaX"in t&&(o=t.deltaX,0===a&&(s=-1*o)),0!==a||0!==o){if(1===t.deltaMode){var c=u.data(this,"mousewheel-line-height");s*=c,a*=c,o*=c}else if(2===t.deltaMode){var d=u.data(this,"mousewheel-page-height");s*=d,a*=d,o*=d}if(r=Math.max(Math.abs(a),Math.abs(o)),(!g||r<g)&&(_(t,g=r)&&(g/=40)),_(t,r)&&(s/=40,o/=40,a/=40),s=Math[1<=s?"floor":"ceil"](s/g),o=Math[1<=o?"floor":"ceil"](o/g),a=Math[1<=a?"floor":"ceil"](a/g),v.settings.normalizeOffset&&this.getBoundingClientRect){var h=this.getBoundingClientRect();n=e.clientX-h.left,l=e.clientY-h.top}return e.deltaX=o,e.deltaY=a,e.deltaFactor=g,e.offsetX=n,e.offsetY=l,e.deltaMode=0,i.unshift(e,s,o,a),f&&clearTimeout(f),f=setTimeout(p,200),(u.event.dispatch||u.event.handle).apply(this,i)}}function p(){g=null}function _(e,t){return v.settings.adjustOldDeltas&&"mousewheel"===e.type&&t%120==0}var f,g,e=["wheel","mousewheel","DOMMouseScroll","MozMousePixelScroll"],i="onwheel"in document||9<=document.documentMode?["wheel"]:["mousewheel","DomMouseScroll","MozMousePixelScroll"],m=Array.prototype.slice;if(u.event.fixHooks)for(var s=e.length;s;)u.event.fixHooks[e[--s]]=u.event.mouseHooks;var v=u.event.special.mousewheel={version:"3.1.12",setup:function(){if(this.addEventListener)for(var e=i.length;e;)this.addEventListener(i[--e],t,!1);else this.onmousewheel=t;u.data(this,"mousewheel-line-height",v.getLineHeight(this)),u.data(this,"mousewheel-page-height",v.getPageHeight(this))},teardown:function(){if(this.removeEventListener)for(var e=i.length;e;)this.removeEventListener(i[--e],t,!1);else this.onmousewheel=null;u.removeData(this,"mousewheel-line-height"),u.removeData(this,"mousewheel-page-height")},getLineHeight:function(e){var t=u(e),i=t["offsetParent"in u.fn?"offsetParent":"parent"]();return i.length||(i=u("body")),parseInt(i.css("fontSize"),10)||parseInt(t.css("fontSize"),10)||16},getPageHeight:function(e){return u(e).height()},settings:{adjustOldDeltas:!0,normalizeOffset:!0}};u.fn.extend({mousewheel:function(e){return e?this.bind("mousewheel",e):this.trigger("mousewheel")},unmousewheel:function(e){return this.unbind("mousewheel",e)}})},"function"==typeof define&&define.amd?define("lib/zui.datagrid.min",[],e):"object"==typeof exports?module.exports=e:e(jQuery),function(A,O){"use strict";var g="zui.datagrid",c={date:{getter:function(e,t,i){var s=i.options.defaultDateFormater;return Date.create(e).format(s)},setter:function(e,t,i){if("string"==typeof e){var s=parseInt(e,10);isNaN(s)||(e=s)}return Date.timestamp(e)}}},d={},r={page:0,recTotal:0,recPerPage:10},h={fixedLeftUntil:0,fixedTopUntil:0,order:"asc",sortBy:null,pager:r,selections:{}},m=function(e,r){var n=0,l=r.length,c=0,d={};return A.each(e,function(e,t){var i=typeof t;"number"===i||"number"===i?t+="":"string"!==i&&(t=JSON.stringify(i));for(var s=0,o=0;o<l;++o){var a=r[o];t.includes(a)&&(s=t.startsWith(a)?10:20,d[a]||(d[a]=1,c++))}n+=s}),n=c===l?n:0},v=function(e,t){return e==t?0:e<t?-1:1},u={zh_cn:{errorCannotGetDataFromRemote:"无法从远程服务器（{0}）获取数据。",errorCannotHandleRemoteData:"无法处理远程服务器返回的数据。"},zh_tw:{errorCannotGetDataFromRemote:"無法從遠程服務器（{0}）獲取數據。",errorCannotHandleRemoteData:"無法處理遠程服務器返回的數據。"},en:{errorCannotGetDataFromRemote:"Cannot fetch data from remote server {0}.",errorCannotHandleRemoteData:"Cannot handle the remote data."}},b=function(e,t){var p=this,i=p.$=A(e);p.name=g,p.uuid=A.zui.uuid(),p.id="zui-datagrid-"+p.uuid;var s=(t=A.extend({},b.DEFAULTS,p.$.data(),t)).lang||"zh_cn";p.lang=A.isPlainObject(s)?A.extend(!0,{},u[s.lang||A.zui.clientLang()],s):u[s],t.valueOperator=A.extend({},c,t.valueOperator),t.rowDefaultHeight=t.rowDefaultHeight||30,t.headerHeight=t.headerHeight||t.rowDefaultHeight||30,"number"!=typeof(p.options=t).borderWidth&&(t.borderWidth=1),i.is("table")&&(t.dataSource=A.extend(function(e){var i=[];e.find("thead>tr:first>th").each(function(e){var t=A(this);if(i.push(A.extend({name:e,label:t.html(),html:!0,width:t.outerWidth()},t.data())),t.attr("colspan")&&"1"!==t.attr("colspan"))throw new Erorr("Table th element with colspan attribute is not support.")});var s=[];return e.find("tbody>tr").each(function(){var e=A(this),t={};e.children("td").each(function(e){t[e]=A(this).html()}),s.push(A.extend(t,e.data()))}),{cols:i,array:s,length:s.length}}(p.$),t.dataSource),i.hide(),i=A('<div class="datagrid" id="datagrid-'+p.uuid+'" />').insertAfter(p.$));var _=i.find(".datagrid-container:first");_.length||(_=A('<div class="datagrid-container" />').appendTo(i)),_.css({width:t.width,borderWidth:t.borderWidth});var f=A(document),o=function(o){var s=_.find(".datagrid-scrollbar-"+o);s.length||(s=A('<div class="datagrid-scrollbar datagrid-scrollbar-'+o+'"><div class="bar"></div></div>').appendTo(_));var a,r,n,l,c=!1,d=null,h=".scrollbar"+o+"."+g+"."+p.uuid,u=function(e){if(c){var t=e["h"===o?"pageX":"pageY"];if(d!==t){t=(d=t)-a+r;var i,s=p.layout[o+"Scroll"];i=n?d-a+l:Math.max(0,Math.min(s.space,t-Math.round(s.barSize/2))),"h"===o?p.setScrollbarOffset(i):p.setScrollbarOffset(null,i)}}};s.on("mousedown",function(e){e.preventDefault(),c=!0;var t=p.layout[o+"Scroll"],i="h"===o?"X":"Y";r=e["offset"+i],a=e["page"+i],n=A(e.target).is(".bar"),l=t.offset,n&&(r+=l),u(e),s.addClass("scrolling"),f.on("mouseup"+h,function(e){c=!1,u(e),f.off(h),s.removeClass("scrolling")}).on("mousemove"+h,u)}),p["$"+o+"Scroll"]=s,p["$"+o+"Scrollbar"]=s.find(".bar")};o("h"),o("v");var a=t.mouseWheelFactor;window.navigator.userAgent.match(/Win/i)&&(a*=20),_.on("mousewheel",function(e){p.scroll(p.layout.scrollLeft-Math.round(e.deltaX*a),p.layout.scrollTop-Math.round(e.deltaY*a)),e.preventDefault()}),p.$container=_;var r=i.find(".datagrid-cells:first");if(r.length||(r=A('<div class="datagrid-cells" />').appendTo(_)),r.toggleClass("datagrid-hover-cell",!!t.hoverCell).toggleClass("datagrid-hover-row",!!t.hoverRow).toggleClass("datagrid-hover-col",!!t.hoverCol).toggleClass("datagrid-hover-shadow",!!t.hoverCol),p.$cells=r,p.isFuncConfigs=A.isFunction(t.configs),p.configs=p.isFuncConfigs?t.configs:A.extend({},d,t.configs),p.layout={scrollLeft:0,scrollTop:0},p.configsCache={},p.userConfigs={},p.states=A.extend(!0,{},h,t.states),p.cells=[],p.setPager(p.states.pager),p.setDataSource(t.dataSource),p.render(!0),t.responsive&&(_.width(),_.on("resize",function(){p.layout.cols=null,p.render()})),t.hoverCol&&r.on("mouseenter",".datagrid-cell-head",function(){var e=A(this).data("col");p.$cells.find(".datagrid-cell.hover").removeClass("hover"),p.$cells.find('.datagrid-cell[data-col="'+e+'"]').addClass("hover")}).on("mouseleave",".datagrid-cell-head.hover",function(){p.$cells.find(".datagrid-cell.hover").removeClass("hover")}),t.sortable&&r.on("click",".datagrid-col-sortable",function(){var e=A(this).data("col"),t=p.getColConfig(e),i=p.states.sortBy,s=p.states.order;i!==t.name?(i=t.name,s="desc"):"desc"===s?s="asc":"asc"===s&&(i=""),p.sortBy(i,s)}),t.checkable&&(t.selectable&&A.fn.selectable?(p.selectable=r.selectable(A.extend({selector:".datagrid-row-cell",trigger:t.checkByClickRow?null:".datagrid-row-cell .datagrid-has-checkbox",clickBehavior:"multi",select:function(e){p.checkRow(e.id,!0)},unselect:function(e){p.checkRow(e.id,!1)}},A.isPlainObject(t.selectable)?t.selectable:null)).data("zui.selectable"),r.on("click",".datagrid-cell-head.datagrid-has-checkbox",function(){p.checkRow(A(this).data("row")),p.selectable.syncSelectionsFromClass()})):r.on("click",t.checkByClickRow?".datagrid-row":".datagrid-has-checkbox",function(e){var t=A(this).data("row");(t||A(e.target).closest(".datagrid-has-checkbox").length)&&p.checkRow(t)})),A.fn.pager){var n=p.$.find(".pager");n.length&&(p.pagerObj=n.pager(A.extend({},p.pager,{onPageChange:function(e){p.setPager(e).render()}})).data("zui.pager"))}if(A.fn.searchBox){var l=p.$.find(".search-box");l&&(p.searchbox=l.searchBox({onSearchChange:function(e){p.search(e)}}))}};b.prototype.setPager=function(e,t,i){var s=this;"object"==typeof e&&(i=e.recPerPage,t=e.recTotal,e=e.page);var o=s.pager,a=A.extend({},o);return o||(o=A.extend({},r)),"number"==typeof i&&0<i&&(o.recPerPage=i),"number"==typeof t&&0<=t&&(o.recTotal=t),"number"==typeof e&&0<=e&&(o.page=e),o.totalPage=o.recTotal&&o.recPerPage?Math.ceil(o.recTotal/o.recPerPage):1,o.page=Math.max(0,Math.min(o.page,o.totalPage)),o.pageRecCount=o.recTotal,o.page&&o.recTotal&&(o.page<o.totalPage?o.pageRecCount=o.recPerPage:1<o.page&&(o.pageRecCount=o.recTotal-o.recPerPage*(o.page-1))),o.skip=1<o.page?(o.page-1)*o.recPerPage:0,o.end=o.skip+o.pageRecCount,s.pager=o,a.page===o.page&&a.recTotal===o.recTotal&&a.recPerPage===o.recPerPage||(s.layout.cols=null,s.scroll(0,0)),s},b.prototype.goToPage=function(e){return this.setPager(e).render()},b.prototype.setSearch=function(e){return e!==O&&null!==e||(e=""),this.states.search=A.trim(e),this},b.prototype.search=function(e){return e!==this.states.search&&this.pager.page&&this.setPager(1),this.setSearch(e).render()},b.prototype.setSorter=function(e,t){return t===O&&(t="desc"===this.states.order?"asc":"desc"),this.states.order=t.toLowerCase(),this.states.sortBy=e,this},b.prototype.sortBy=function(e,t){return this.setSorter(e,t).render()},b.prototype.setDataSource=function(e,t){var i=this,s={},o=i.dataSource&&i.dataSource.cols;if(A.isArray(e)?(s.array=e,s.length=e.length,i.setPager("",e.length)):A.isPlainObject(e)?s=A.extend(s,e):"string"==typeof e&&(s.remote=e),!0===s.cache||s.cache===O?(s.cache=[],s.cacheSize=1):"number"==typeof s.cache&&(s.cacheSize=s.cache,s.cache=[]),A.isArray(s.data)?(s.array=s.data,s.length=s.array.length,i.setPager("",s.length),delete s.data):!s.data&&A.isFunction(s.getByIndex)&&i.setPager("",s.length),i.dataSource=s,(t=t||s.cols||o||[]).length)for(var a=0;a<t.length;++a){var r=t[a];"string"==typeof r&&(t[a]={name:r})}t!==o&&(i.layout.cols=null),s.cols=t},b.prototype.filterData=function(e,t){var s=this,i=e,o=null;if(t.search){var a=t.search.replace(/\s{2,}/g," ").split(" ");i=[];for(var r=s.options.searchFunc||m,n=0;n<e.length;++n){var l=e[n],c=r(l,a,n,t,s);c&&(null===o&&(o="number"==typeof c),o&&(l._SCORE=c),i.push(l))}}if(s.setPager(-1,i.length),i.length){var d=t.sortBy||!!o&&"_SCORE";if(d){var h="_SCORE"===d?"DESC":t.order,u=s.getColConfigByName(d),p="desc"===h,_=u&&u.sortFunc||s.options.sortFunc||v;i.sort(function(e,t){var i=_(e[d],t[d],e,t,d,s);return p?-1*i:i})}var f=s.pager;f.page&&(1<f.page&&(f.page,f.recPerPage),i=i.slice(f.skip,f.end))}return i},b.prototype.getFilterParams=function(){var e=this.states;return{page:this.pager.page,recPerPage:this.pager.recPerPage,search:e.search,sortBy:e.sortBy,order:e.order}},b.prototype.loadData=function(t){var a=this;a.loadingId=A.zui.uuid();var i=function(e){return a.$.callComEvent(a,"onLoad",e),t&&t(e)},e=a.getFilterParams(),s=[e.page,e.recPerPage,e.search,e.sortBy,e.order].join("&"),o=a.getData(s);if(o)return i(o);var r=a.dataSource;if(r.array)return o=a.filterData(r.array,e),a.resetData(s,o,a.pager),i(o);if(r.getByIndex)return o=r.getByIndex,a.resetData(s,o),i(o);var n=r.loader,l=r.remote;if(!n&&l&&(n=function(e,o){var t=A.isFunction(l)?l(e,a):{url:l};A.ajax(A.extend({type:"GET",data:e,dataType:"json",success:function(e,t,i){if(r.remoteConverter&&(e=r.remoteConverter(e,t,i,a)),"string"==typeof e&&(e=A.parseJSON(e)),A.isPlainObject(e)&&e.data){var s=e.result||e.status;"success"===s||"ok"===s||200===s?o(e):o(!1,e.message||e.reason||a.lang.errorCannotHandleRemoteData,e)}else o(!1,a.lang.errorCannotHandleRemoteData,e)},error:function(){o(!1,a.lang.errorCannotGetDataFromRemote.format(r.remote))}},t))}),!n)return i(!1);a.renderLoading(!0);var c=a.loadingId;n(e,function(e,t){if(c===a.loadingId){if(a.renderLoading(!1),t)return a.showMessage(t,"danger"),void i(!1);a.resetData(s,e.data,e.pager),i(e.data)}})},b.prototype.getDataItem=function(e,t,i){return"function"==typeof(t=t||this.getData())?t(e,i=i||this.getFilterParams()):t[e]},b.prototype.showMessage=function(e,t,i){var s=this;s.msgerAutoCloseTimer&&(clearTimeout(s.msgerAutoCloseTimer),s.msgerAutoCloseTimer=null);var o=s.$container.find(".datagrid-messager");return e?(t=t||"info",i===O&&(i=5e3),o.length||(o=A('<div class="datagrid-messager" style="display: none"><div class="content"></div><button type="button" class="close">×</button></div>').appendTo(s.$container).on("click",".close",function(){o.slideUp(),s.msgerAutoCloseTimer&&(clearTimeout(s.msgerAutoCloseTimer),s.msgerAutoCloseTimer=null)})),o.attr("class","datagrid-messager bg-"+t).find(".content").text(e),o.slideDown(),void(i&&(s.msgerAutoCloseTimer=setTimeout(function(){o.slideUp(),s.msgerAutoCloseTimer=null},i)))):void o.slideUp()},b.prototype.renderLoading=function(e){e!==O&&(this.states.loading=e);var t=this.$container.find(".datagrid-loading");e?(t.length||(t=A('<div class="datagrid-loading" style="display: none"><div class="content"><i class="icon icon-spin icon-spinner icon-2x"></i><div className="datagrid-loading-message"></div></div></div>').appendTo(this.$container)),t.find(".datagrid-loading-message").text("string"==typeof e?e:""),t.fadeIn()):t.fadeOut()},b.prototype.getData=function(e){var t=this.dataSource,i=null;if(e&&e!==t.dataId){if(t.cache&&t.cache.length)for(var s=t.cache.length-1;0<=s;--s){var o=t.cache[s];if(o.id===e){t.dataId=e,t.data=o.data,this.setPager(o.pager),i=o.data;break}}}else i=t.data;return i},b.prototype.resetData=function(e,t,i){var s=this.dataSource;if(s.dataId=e,s.data=t,s.cache){for(var o=s.cache.length-1;0<o;--o){if(s.cache[o].id===e){s.cache.splice(o,1);break}}for(s.cache.push({id:e,data:t,pager:A.extend({},i)});s.cache.length>s.cacheSize;)s.cache.shift()}i&&this.setPager(i)},b.prototype.getRowLayout=function(e){var t=this.layout;if(0===e)return{top:0,height:t.headerHeight};var i=t.rowHeight;return{height:i,top:t.headerHeight+(1<e?(e-1)*i:0)+e*t.borderWidth}},b.prototype.updateLayout=function(){var e=this,t=e.options,i=e.layout,s=(e.data,e.pager),o=s.pageRecCount,a=e.$container,r=a.width(),n=e.dataSource;if(!n.cols.length&&o&&A.each(e.getDataItem(0),function(e){n.cols.push({name:e})}),!i.cols){for(var l,c,d=n.cols,h=t.colAutoMinWidth,u=t.colAutoDefaultWidth,p=0,_=0,f=t.rowIndexWidth,g=[{left:0,width:t.showRowIndex?"auto"===f?8*(o+e.pager.skip+"").length+18:f:0}],m=0,v=g[0].width,b=!1,y=0,w=0,x=0;x<d.length;++x){var C=d[x];C&&((c=C.width)&&"auto"!==c||(c=.1),l={left:0},1<=c?(C.minWidth!==O&&(c=Math.max(c,C.minWidth)),v+=l.width=c):(C.minWidth===O&&(C.minWidth=h),p+=l.grow=c,_+=C.minWidth,y<=l.grow&&(y=l.grow,b=x+1)),l.minWidth=C.minWidth,!w&&C.checkbox&&(w=x+1,l.checkbox=!0),g.push(l))}t.checkable&&!w&&(g[0].checkbox=!0,"auto"===f&&(g[0].width+=30,v+=30));for(var k=r-v,T=k<_,I=g.length,S=0;S<I;++S){if((c=(l=g[S]).width)||0===c||(c=T?u*l.grow*10:k*l.grow/p,c=Math.floor(Math.max(l.minWidth,c)),l.width=c),0<S){var D=g[S-1];l.left=D.left+D.width}m+=c}var E=r-m;b&&0<E&&(g[b].width+=E,m+=E),i.width=m,i.cols=g}i.containerWidth=r,i.rowHeight=t.rowDefaultHeight,i.borderWidth=t.borderWidth,i.headerHeight=t.showHeader?t.headerHeight:0,i.rowsLength=o+1,i.colsLength=i.cols.length,i.height=i.headerHeight+o*(i.rowHeight+i.borderWidth),i.spanMap={};var M=t.height;"page"===M&&(M=i.headerHeight+e.pager.recPerPage*(i.rowHeight+i.borderWidth)),a.css("height",M),i.containerHeight=M,i.vScrollSpare=i.height-i.containerHeight,i.hScrollSpare=i.width-i.containerWidth,e.layout=i;var R=!!s.page||t.partialRendering;return"auto"===R&&(R=i.height>2*i.containerHeight),i.partialRendering=R,i},b.prototype.getCell=function(e,t){var i,s,o=this,a=o.getCellConfig(e,t),r=0<t?o.dataSource.cols[t-1]:null,n={rowIndex:e,colIndex:t,config:a,checked:o.isRowChecked(a.rowId)};if(0===t){i="index";var l=0<e?o.pager.skip+e:"";s=a.label!==O?a.label:l}else 0===e?(i="head",s=a.label!==O?a.label:a.name!==O?a.name:t):(i="cell",s=a.data&&a.data[o.options.dataItemIsArray?t:r.name]);if(0<e){var c=o.options.valueOperator,d=a.valueType,h=a.valueOperator||(c&&d?c[d]:null);h&&h.getter&&(s=h.getter(s,n,o))}n.value=s,n.type=i;var u=o.layout.spanMap;if(u[a.id]||a.hidden)n.hidden=!0;else if(a.colspan&&1<a.colspan||a.rowspan&&1<a.rowspan){for(var p=e+(a.rowspan||1),_=t+(a.colspan||1),f=e;f<p;++f)for(var g=t;g<_;++g)f===e&&g===t||(u["R"+f+"C"+g]=a.id);a.span=!0}return n},b.prototype.getRowConfig=function(e){var t=this,i="R"+e,s=t.configsCache[i];s||(s=A.extend({},t.isFuncConfigs?t.configs(i):t.configs[i],t.userConfigs[i]),t.configsCache[i]=s);var o=0<e?t.getDataItem(e-1):null;i=(s.data=o)&&(o.rowId||o.id);return s.rowId=i!==O?i:0===e?"#header":e,s},b.prototype.getColConfigByName=function(e){for(var t=this.dataSource.cols,i=0;i<t.length;++i)if(t[i].name===e)return this.getColConfig(i+1);return null},b.prototype.getColConfig=function(e){var t=this,i="C"+e,s=null;return s||(s=A.extend({valueType:"string"},0<e?t.dataSource.cols[e-1]:null,t.layout.cols?t.layout.cols[e]:null,t.isFuncConfigs?t.configs(i):t.configs[i],t.userConfigs[i])),s},b.prototype.getCellConfig=function(e,t){var i=this,s="R"+e+"C"+t,o=null;return o||(o=A.extend({id:s},i.getColConfig(t),i.getRowConfig(e),i.isFuncConfigs?i.configs(s):i.configs[s],i.userConfigs[s])),o},b.prototype.isRowChecked=function(e){return!!this.states.selections[e]},b.prototype.checkRow=function(e,t){var i=this,s=i.states.selections,o=i.getRowConfig(e),a=o.rowId;if(t===O&&(t=!s[a]),s[a]!==t){if(t?s[a]=o:(delete s[a],0<e&&s["#header"]&&(delete s["#header"],i.renderRow(0))),i.renderRow(e),0===e&&i.layout.rowsLength<500)for(var r=1;r<i.layout.rowsLength;++r)i.checkRow(r,t);return i.renderFixeds(),t}},b.prototype.getCheckItems=function(){var t=this.states.selections,i=[];return t&&A.each(t,function(e){i.push(t[e].data)}),i},b.prototype.renderCell=function(e,t,i){var s=this,o=s.options,a=s.getCell(e,t),r=a.config;if(!a.hidden){var n=r.checkbox,l=[s.id,"cell",e,t].join("-"),c=A("#"+l);if(!c.length&&(i=i||A("#"+s.id+"-row-"+e),(c=(o.cellCreator?o.cellCreator(a,s):A('<div class="datagrid-cell" />')).appendTo(i)).attr({id:l,"data-type":a.type,"data-col":a.colIndex,"data-row":a.rowIndex}).toggleClass("datagrid-cell-head",0===e).toggleClass("datagrid-cell-cell","cell"===a.type).toggleClass("datagrid-cell-index",0===t),n)){var d=c.find(".datagrid-checkbox");d.length||(d=A('<div class="checkbox-primary datagrid-checkbox"><label></label></div>').prependTo(c.addClass("datagrid-has-checkbox"))),c.append('<span class="content"></span>')}var h=o.borderWidth,u=s.layout,p=u.colsLength,_={top:h?-h:0,bottom:h?-h:0,left:h?r.left-h:r.left,width:h?r.width+(p-1===t?2:1)*h:r.width,borderWidth:h};if(r.span&&(r.rowspan&&1<r.rowspan&&(_.bottom-=(r.rowspan-1)*(u.rowHeight+h)),r.colspan&&1<r.colspan))for(var f=t+r.colspan,g=t+1;g<f;++g){var m=s.getCell(e,g);_.width+=m.config.width}var v=r.style;A.isFunction(v)&&(v=v(a,_,s));var b=A.extend({},v,_);if(c.css(b).toggleClass("datagrid-cell-span",!!r.span),o.cellFormator)o.cellFormator(c,a,s);else(n?c.find(".content"):c)[a.config.html?"html":"text"](a.value),r.className&&c.addClass(r.className);if(0<t&&0===e&&o.sortable&&!1!==r.sort){var y=!1;r.name===s.states.sortBy&&(y="desc"===s.states.order?"down":"up");var w=c.find(".datagrid-sorter");w.length||(w=A('<div class="datagrid-sorter"><i class="icon icon-sort"></i></div>').appendTo(c),c.addClass("datagrid-col-sortable")),w.toggleClass("datagrid-sort-up","up"===y).toggleClass("datagrid-sort-down","down"===y)}return n&&(c.find(".datagrid-checkbox").toggleClass("checked",a.checked),i.toggleClass("active",a.checked)),c}},b.prototype.renderRow=function(e){var t=this,i=t.layout,s=t.options,o=t.getRowLayout(e),a=i.colsLength,r=t.id+"-row-"+e,n=A("#"+r);n.length?i.partialRendering&&n.css("top",o.top-i.scrollTop):(n=(s.rowCreator?s.rowCreator(e,t):A('<div class="datagrid-row" />')).appendTo(t.$cells)).attr({id:r,"data-row":e,"data-id":e}).css({top:i.partialRendering?o.top-i.scrollTop:o.top,height:o.height}).toggleClass("datagrid-row-head",0===e).toggleClass("datagrid-row-cell",0!==e);for(var l=0;l<a;++l)t.renderCell(e,l,n);return n},b.prototype.renderData=function(){var e=this,t=e.layout;t.cols||e.updateLayout();var i=1,s=t.rowsLength-1;if(t.partialRendering){var o=t.rowHeight+t.borderWidth;i=Math.min(s,Math.max(1,Math.floor((t.scrollTop-t.headerHeight)/o))),s=Math.min(s,Math.max(1,Math.ceil((t.scrollTop+t.containerHeight-t.headerHeight)/o))),e.$cells.find(".datagrid-row").each(function(){var e=A(this),t=e.data("row");0<t&&!e.hasClass("datagrid-fixed")&&(t<i||s<t)&&e.remove()})}e.options.showHeader&&e.renderRow(0);for(var a=i;a<=s;++a)e.renderRow(a);if(t.vScrollSpare){var r=e.states,n=r.fixedTopUntil,l=r.fixedBottomFrom;if("number"==typeof n&&0<n&&n<i)for(a=1;a<=n;++a)e.renderRow(a);if("number"==typeof l&&0<l&&s<l)for(a=l;a<=t.rowsLength-1;++a)e.renderRow(a)}e.pagerObj&&e.pagerObj.set(e.pager)},b.prototype.render=function(e){var i=this,t=i.options;return!e&&t.renderDelay?(i.renderDelayTimer&&clearTimeout(i.renderDelayTimer),i.renderDelayTimer=setTimeout(function(){i.render(!0)},t.renderDelay)):(i.renderDelayTimer&&(clearTimeout(i.renderDelayTimer),i.renderDelayTimer=null),i.loadData(function(e){var t=i.updateLayout();i.$cells.css({width:t.width,height:t.partialRendering?t.containerHeight:i.layout.height}),i.renderData(),i.renderScrolls(),i.renderFixeds(),i.$.callComEvent(i,"onRender")})),i},b.prototype.setScrollbarOffset=function(e,t){var i=this.layout,s=i.scrollLeft,o=i.scrollTop;if("number"==typeof e){var a=i.hScroll;a.offset!==e&&(s=Math.round(e*i.hScrollSpare/a.space))}if("number"==typeof t){var r=i.vScroll;r.offset!==t&&(o=Math.round(t*i.vScrollSpare/r.space))}this.scroll(s,o)},b.prototype.renderScrolls=function(){var e=this,t=e.layout,i=t.vScrollSpare,s=t.hScrollSpare,o=0<i,a=0<s;if(e.$vScroll.toggle(o),e.$hScroll.toggle(a),t.scrollLeft=a?Math.max(0,Math.min(s,t.scrollLeft)):0,t.scrollTop=o?Math.max(0,Math.min(i,t.scrollTop)):0,o){var r=e.$vScrollbar,n=t.containerHeight/t.height,l=Math.max(20,Math.floor(n*t.containerHeight)),c=(u=t.containerHeight-l)/i,d=Math.round(t.scrollTop*c);t.vScroll={space:u,size:i,scale:c,barSize:l,offset:d};var h={height:l,top:d};r.css(h)}if(a){r=e.$hScrollbar,n=t.containerWidth/t.width,l=Math.max(20,Math.floor(n*t.containerWidth));var u=t.containerWidth-l;h={width:l,left:d=Math.round(t.scrollLeft*u/s)};t.hScroll={offset:d,space:u,size:s,barSize:l},r.css(h)}e.$cells.css({top:t.partialRendering?0:-t.scrollTop,left:-t.scrollLeft})},b.prototype.scroll=function(e,t,i){var s=this,o=new Date,a=s.options.scrollDelay;if(a){if(!i&&s.lastScrollTime&&o-s.lastScrollTime<a)return s.scrollDelayTimer&&clearTimeout(s.scrollDelayTimer),void(s.scrollDelayTimer=setTimeout(function(){s.scroll(e,t)},a-(o-s.lastScrollTime)));s.scrollDelayTimer&&(clearTimeout(s.scrollDelayTimer),s.scrollDelayTimer=null),s.lastScrollTime=o}var r=s.layout,n=!1,l=!1;"number"==typeof e&&((e=Math.max(0,Math.min(e,r.width-r.containerWidth)))!==r.scrollLeft&&(n=!0,r.scrollLeft=e)),"number"==typeof t&&((t=Math.max(0,Math.min(t,r.height-r.containerHeight)))!==r.scrollTop&&(l=!0,r.scrollTop=t)),l&&r.partialRendering&&s.renderData(),(n||l)&&(s.renderScrolls(),s.renderFixeds()),s.$.callComEvent(s,"onScroll",[e,t,{vScrolled:l,hScrolled:n}])},b.prototype.renderFixeds=function(){var e=this,t=e.states,i=e.layout;if(e.$cells.find(".datagrid-fixed").removeClass("datagrid-fixed"),e.$cells.find(".datagrid-fixed-edge-top").removeClass("datagrid-fixed-edge-top"),e.$cells.find(".datagrid-fixed-edge-bottom").removeClass("datagrid-fixed-edge-bottom"),e.$cells.find(".datagrid-fixed-edge-left").removeClass("datagrid-fixed-edge-left"),e.$cells.find(".datagrid-fixed-edge-right").removeClass("datagrid-fixed-edge-right"),i.vScrollSpare){var s=t.fixedTopUntil;if("number"==typeof s&&-1<s){s=Math.min(s,i.rowsLength);for(var o=0;o<=s;++o){var a=e.getRowLayout(o),r=A("#"+e.id+"-row-"+o),n=i.partialRendering?a.top:a.top+i.scrollTop;r.addClass("datagrid-fixed").css("top",n),o===s&&i.scrollTop&&r.addClass("datagrid-fixed-edge-top")}}else s=-1;var l=t.fixedBottomFrom;if("number"==typeof l&&-1<l)for(o=l=Math.max(-1<s?s+1:1,Math.min(l,i.rowsLength));o<i.rowsLength;++o){a=e.getRowLayout(o),r=A("#"+e.id+"-row-"+o),n=i.partialRendering?a.top-i.vScrollSpare:a.top-i.vScrollSpare+i.scrollTop;r.addClass("datagrid-fixed").css("top",n),o===l&&i.scrollTop<i.vScrollSpare&&r.addClass("datagrid-fixed-edge-bottom")}}if(i.hScrollSpare){var c=t.fixedLeftUntil;if("number"==typeof c&&-1<c){c=Math.min(c,i.colsLength);for(o=0;o<=c;++o){var d=i.cols[o],h=e.$cells.find('.datagrid-cell[data-col="'+o+'"]'),u=d.left+i.scrollLeft-i.borderWidth;h.addClass("datagrid-fixed").css("left",u),o===c&&i.scrollLeft&&h.addClass("datagrid-fixed-edge-left")}}else c=-1;var p=t.fixedRightFrom;if("number"==typeof p&&-1<p)for(o=p=Math.max(-1<c?c+1:1,Math.min(p,i.colsLength));o<i.colsLength;++o){d=i.cols[o],h=e.$cells.find('.datagrid-cell[data-col="'+o+'"]'),u=d.left-i.hScrollSpare+i.scrollLeft;h.addClass("datagrid-fixed").css("left",u),o===p&&i.scrollLeft<i.hScrollSpare&&h.addClass("datagrid-fixed-edge-right")}}},b.DEFAULTS={width:"auto",height:400,rowDefaultHeight:36,colAutoDefaultWidth:80,colAutoMinWidth:50,showHeader:!0,headerHeight:36,showRowIndex:!0,rowIndexWidth:"auto",borderWidth:1,hoverRow:!0,hoverCol:!0,hoverCell:!1,responsive:!0,defaultDateFormater:"yyyy-MM-dd hh:mm",partialRendering:"auto",scrollDelay:0,renderDelay:100,checkByClickRow:!0,selectable:!0,mouseWheelFactor:1},A.fn.datagrid=function(s){return this.each(function(){var e=A(this),t=e.data(g),i="object"==typeof s&&s;t||e.data(g,t=new b(this,i)),"string"==typeof s&&t[s]()})},b.NAME=g,A.fn.datagrid.Constructor=b,A(function(){A('[data-ride="datagrid"]').datagrid()})}(jQuery,void 0)}),function(e,t){"object"==typeof exports?module.exports=t():"function"==typeof define&&(define.amd||define.cmd)?define("lib/chosen.min",[],t):e.eventUtil=t()}(this,function(){(function(){var l,i,o,r,a={}.hasOwnProperty,s={zh_cn:{no_results_text:"没有找到"},zh_tw:{no_results_text:"沒有找到"},en:{no_results_text:"No results match"}};(r=function(){function e(){this.options_index=0,this.parsed=[]}return e.prototype.add_node=function(e){return"OPTGROUP"===e.nodeName.toUpperCase()?this.add_group(e):this.add_option(e)},e.prototype.add_group=function(e){var t,i,s,o,a,r;for(t=this.parsed.length,this.parsed.push({array_index:t,group:!0,label:this.escapeExpression(e.label),children:0,disabled:e.disabled,title:e.title,search_keys:l.trim(e.getAttribute("data-keys")||"").replace(/,/g," ")}),r=[],s=0,o=(a=e.childNodes).length;s<o;s++)i=a[s],r.push(this.add_option(i,t,e.disabled));return r},e.prototype.add_option=function(e,t,i){if("OPTION"===e.nodeName.toUpperCase())return""!==e.text?(null!=t&&(this.parsed[t].children+=1),this.parsed.push({array_index:this.parsed.length,options_index:this.options_index,value:e.value,text:e.text,title:e.title,html:e.innerHTML,selected:e.selected,disabled:!0===i?i:e.disabled,group_array_index:t,classes:e.className,style:e.style.cssText,search_keys:(l.trim(e.getAttribute("data-keys")||"")+e.value).replace(/,/," ")})):this.parsed.push({array_index:this.parsed.length,options_index:this.options_index,empty:!0}),this.options_index+=1},e.prototype.escapeExpression=function(e){var t,i;return null==e||!1===e?"":/[\&\<\>\"\'\`]/.test(e)?(t={"<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},i=/&(?!\w+;)|[\<\>\"\'\`]/g,e.replace(i,function(e){return t[e]||"&amp;"})):e},e}()).select_to_array=function(e){var t,i,s,o,a;for(i=new r,s=0,o=(a=e.childNodes).length;s<o;s++)t=a[s],i.add_node(t);return i.parsed},i=function(){function i(e,t){this.form_field=e,this.options=null!=t?t:{},i.browser_is_supported()&&(this.lang=s[this.options.lang||(l.zui.clientLang?l.zui.clientLang():"zh_cn")],this.is_multiple=this.form_field.multiple,this.set_default_text(),this.set_default_values(),this.setup(),this.set_up_html(),this.register_observers())}return i.prototype.set_default_values=function(){var t=this;return this.click_test_action=function(e){return t.test_active_click(e)},this.activate_action=function(e){return t.activate_field(e)},this.active_field=!1,this.mouse_on_container=!1,this.results_showing=!1,this.result_highlighted=null,this.allow_single_deselect=null!=this.options.allow_single_deselect&&null!=this.form_field.options[0]&&""===this.form_field.options[0].text&&this.options.allow_single_deselect,this.disable_search_threshold=this.options.disable_search_threshold||0,this.disable_search=this.options.disable_search||!1,this.enable_split_word_search=null==this.options.enable_split_word_search||this.options.enable_split_word_search,this.group_search=null==this.options.group_search||this.options.group_search,this.search_contains=this.options.search_contains||!1,this.single_backstroke_delete=null==this.options.single_backstroke_delete||this.options.single_backstroke_delete,this.max_selected_options=this.options.max_selected_options||1/0,this.drop_direction=this.options.drop_direction||"auto",this.middle_highlight=this.options.middle_highlight,this.inherit_select_classes=this.options.inherit_select_classes||!1,this.display_selected_options=null==this.options.display_selected_options||this.options.display_selected_options,this.display_disabled_options=null==this.options.display_disabled_options||this.options.display_disabled_options},i.prototype.set_default_text=function(){return this.form_field.getAttribute("data-placeholder")?this.default_text=this.form_field.getAttribute("data-placeholder"):this.is_multiple?this.default_text=this.options.placeholder_text_multiple||this.options.placeholder_text||i.default_multiple_text:this.default_text=this.options.placeholder_text_single||this.options.placeholder_text||i.default_single_text,this.results_none_found=this.form_field.getAttribute("data-no_results_text")||this.options.no_results_text||this.lang.no_results_text||i.default_no_result_text},i.prototype.mouse_enter=function(){return this.mouse_on_container=!0},i.prototype.mouse_leave=function(){return this.mouse_on_container=!1},i.prototype.input_focus=function(e){var t=this;if(this.is_multiple){if(!this.active_field)return setTimeout(function(){return t.container_mousedown()},50)}else if(!this.active_field)return this.activate_field()},i.prototype.input_blur=function(e){var t=this;if(!this.mouse_on_container)return this.active_field=!1,setTimeout(function(){return t.blur_test()},100)},i.prototype.results_option_build=function(e){var t,i,s,o,a;for(t="",s=0,o=(a=this.results_data).length;s<o;s++)t+=(i=a[s]).group?this.result_add_group(i):this.result_add_option(i),(null!=e?e.first:void 0)&&(i.selected&&this.is_multiple?this.choice_build(i):i.selected&&!this.is_multiple&&this.single_set_selected_text(i.text));return t},i.prototype.result_add_option=function(e){var t,i;return e.search_match&&this.include_option_in_results(e)?(t=[],e.disabled||e.selected&&this.is_multiple||t.push("active-result"),!e.disabled||e.selected&&this.is_multiple||t.push("disabled-result"),e.selected&&t.push("result-selected"),null!=e.group_array_index&&t.push("group-option"),""!==e.classes&&t.push(e.classes),(i=document.createElement("li")).className=t.join(" "),i.style.cssText=e.style,i.title=e.title,i.setAttribute("data-option-array-index",e.array_index),i.innerHTML=e.search_text,this.outerHTML(i)):""},i.prototype.result_add_group=function(e){var t;return(e.search_match||e.group_match)&&0<e.active_options?((t=document.createElement("li")).className="group-result",t.title=e.title,t.innerHTML=e.search_text,this.outerHTML(t)):""},i.prototype.results_update_field=function(){if(this.set_default_text(),this.is_multiple||this.results_reset_cleanup(),this.result_clear_highlight(),this.results_build(),this.results_showing)return this.winnow_results()},i.prototype.reset_single_select_options=function(){var e,t,i,s,o;for(o=[],t=0,i=(s=this.results_data).length;t<i;t++)(e=s[t]).selected?o.push(e.selected=!1):o.push(void 0);return o},i.prototype.results_toggle=function(){return this.results_showing?this.results_hide():this.results_show()},i.prototype.results_search=function(e){return this.results_showing?this.winnow_results(1):this.results_show()},i.prototype.winnow_results=function(e){var t,i,s,o,a,r,n,l,c,d,h,u,p;for(this.no_results_clear(),a=0,t=(n=this.get_search_text()).replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),o=this.search_contains?"":"^",s=new RegExp(o+t,"i"),d=new RegExp(t,"i"),h=0,u=(p=this.results_data).length;h<u;h++)(i=p[h]).search_match=!1,r=null,this.include_option_in_results(i)&&(i.group&&(i.group_match=!1,i.active_options=0),null!=i.group_array_index&&this.results_data[i.group_array_index]&&(0===(r=this.results_data[i.group_array_index]).active_options&&r.search_match&&(a+=1),r.active_options+=1),i.group&&!this.group_search||(i.search_text=i.group?i.label:i.html,i.search_keys_match=this.search_string_match(i.search_keys,s),i.search_text_match=this.search_string_match(i.search_text,s),i.search_match=i.search_text_match||i.search_keys_match,i.search_match&&!i.group&&(a+=1),i.search_match?(i.search_text_match&&i.search_text.length?(l=i.search_text.search(d),c=i.search_text.substr(0,l+n.length)+"</em>"+i.search_text.substr(l+n.length),i.search_text=c.substr(0,l)+"<em>"+c.substr(l)):i.search_keys_match&&i.search_keys.length&&(l=i.search_keys.search(d),c=i.search_keys.substr(0,l+n.length)+"</em>"+i.search_keys.substr(l+n.length),i.search_text+='&nbsp; <small style="opacity: 0.7">'+c.substr(0,l)+"<em>"+c.substr(l)+"</small>"),null!=r&&(r.group_match=!0)):null!=i.group_array_index&&this.results_data[i.group_array_index].search_match&&(i.search_match=!0)));return this.result_clear_highlight(),a<1&&n.length?(this.update_results_content(""),this.no_results(n)):(this.update_results_content(this.results_option_build()),this.winnow_results_set_highlight(e))},i.prototype.search_string_match=function(e,t){var i,s,o,a;if(t.test(e))return!0;if(this.enable_split_word_search&&(0<=e.indexOf(" ")||0===e.indexOf("["))&&(s=e.replace(/\[|\]/g,"").split(" ")).length)for(o=0,a=s.length;o<a;o++)if(i=s[o],t.test(i))return!0},i.prototype.choices_count=function(){var e,t,i,s;if(null!=this.selected_option_count)return this.selected_option_count;for(t=this.selected_option_count=0,i=(s=this.form_field.options).length;t<i;t++)(e=s[t]).selected&&""!=e.value&&(this.selected_option_count+=1);return this.selected_option_count},i.prototype.choices_click=function(e){if(e.preventDefault(),!this.results_showing&&!this.is_disabled)return this.results_show()},i.prototype.keyup_checker=function(e){var t,i;switch(t=null!=(i=e.which)?i:e.keyCode,this.search_field_scale(),t){case 8:if(this.is_multiple&&this.backstroke_length<1&&0<this.choices_count())return this.keydown_backstroke();if(!this.pending_backstroke)return this.result_clear_highlight(),this.results_search();break;case 13:if(e.preventDefault(),this.results_showing)return this.result_select(e);break;case 27:return this.results_showing&&this.results_hide(),!0;case 9:case 38:case 40:case 16:case 91:case 17:break;default:return this.results_search()}},i.prototype.clipboard_event_checker=function(e){var t=this;return setTimeout(function(){return t.results_search()},50)},i.prototype.container_width=function(){return null!=this.options.width?this.options.width:this.form_field.offsetWidth+"px"},i.prototype.include_option_in_results=function(e){return!(this.is_multiple&&!this.display_selected_options&&e.selected||!this.display_disabled_options&&e.disabled||e.empty)},i.prototype.search_results_touchstart=function(e){return this.touch_started=!0,this.search_results_mouseover(e)},i.prototype.search_results_touchmove=function(e){return this.touch_started=!1,this.search_results_mouseout(e)},i.prototype.search_results_touchend=function(e){if(this.touch_started)return this.search_results_mouseup(e)},i.prototype.outerHTML=function(e){var t;return e.outerHTML?e.outerHTML:((t=document.createElement("div")).appendChild(e),t.innerHTML)},i.browser_is_supported=function(){return"Microsoft Internet Explorer"===window.navigator.appName?8<=document.documentMode:!(/iP(od|hone)/i.test(window.navigator.userAgent)||/Android/i.test(window.navigator.userAgent)&&/Mobile/i.test(window.navigator.userAgent))},i.default_multiple_text="",i.default_single_text="",i.default_no_result_text="No results match",i}(),(l=jQuery).fn.extend({chosen:function(s){return i.browser_is_supported()?this.each(function(e){var t,i;i=(t=l(this)).data("chosen"),"destroy"===s&&i?i.destroy():i||t.data("chosen",new o(this,s))}):this}}),o=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return function(e,t){function i(){this.constructor=e}for(var s in t)a.call(t,s)&&(e[s]=t[s]);i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(t,i),t.prototype.setup=function(){return this.form_field_jq=l(this.form_field),this.current_selectedIndex=this.form_field.selectedIndex,this.is_rtl=this.form_field_jq.hasClass("chosen-rtl")},t.prototype.set_up_html=function(){var e,t;(e=["chosen-container"]).push("chosen-container-"+(this.is_multiple?"multi":"single")),this.inherit_select_classes&&this.form_field.className&&e.push(this.form_field.className),this.is_rtl&&e.push("chosen-rtl");var i=this.form_field.getAttribute("data-css-class");return i&&e.push(i),t={class:e.join(" "),style:"width: "+this.container_width()+";",title:this.form_field.title},this.form_field.id.length&&(t.id=this.form_field.id.replace(/[^\w]/g,"_")+"_chosen"),this.container=l("<div />",t),this.is_multiple?this.container.html('<ul class="chosen-choices"><li class="search-field"><input type="text" value="'+this.default_text+'" class="default" autocomplete="off" style="width:25px;" /></li></ul><div class="chosen-drop"><ul class="chosen-results"></ul></div>'):this.container.html('<a class="chosen-single chosen-default" tabindex="-1"><span>'+this.default_text+'</span><div><b></b></div></a><div class="chosen-drop"><div class="chosen-search"><input type="text" autocomplete="off" /></div><ul class="chosen-results"></ul></div>'),this.form_field_jq.hide().after(this.container),this.dropdown=this.container.find("div.chosen-drop").first(),this.search_field=this.container.find("input").first(),this.search_results=this.container.find("ul.chosen-results").first(),this.search_field_scale(),this.search_no_results=this.container.find("li.no-results").first(),this.is_multiple?(this.search_choices=this.container.find("ul.chosen-choices").first(),this.search_container=this.container.find("li.search-field").first()):(this.search_container=this.container.find("div.chosen-search").first(),this.selected_item=this.container.find(".chosen-single").first()),this.options.drop_width&&this.dropdown.css("width",this.options.drop_width).addClass("chosen-drop-size-limited"),this.results_build(),this.set_tab_index(),this.set_label_behavior(),this.form_field_jq.trigger("chosen:ready",{chosen:this})},t.prototype.register_observers=function(){var t=this;return this.container.bind("mousedown.chosen",function(e){t.container_mousedown(e)}),this.container.bind("mouseup.chosen",function(e){t.container_mouseup(e)}),this.container.bind("mouseenter.chosen",function(e){t.mouse_enter(e)}),this.container.bind("mouseleave.chosen",function(e){t.mouse_leave(e)}),this.search_results.bind("mouseup.chosen",function(e){t.search_results_mouseup(e)}),this.search_results.bind("mouseover.chosen",function(e){t.search_results_mouseover(e)}),this.search_results.bind("mouseout.chosen",function(e){t.search_results_mouseout(e)}),this.search_results.bind("mousewheel.chosen DOMMouseScroll.chosen",function(e){t.search_results_mousewheel(e)}),this.search_results.bind("touchstart.chosen",function(e){t.search_results_touchstart(e)}),this.search_results.bind("touchmove.chosen",function(e){t.search_results_touchmove(e)}),this.search_results.bind("touchend.chosen",function(e){t.search_results_touchend(e)}),this.form_field_jq.bind("chosen:updated.chosen",function(e){t.results_update_field(e)}),this.form_field_jq.bind("chosen:activate.chosen",function(e){t.activate_field(e)}),this.form_field_jq.bind("chosen:open.chosen",function(e){t.container_mousedown(e)}),this.form_field_jq.bind("chosen:close.chosen",function(e){t.input_blur(e)}),this.search_field.bind("blur.chosen",function(e){t.input_blur(e)}),this.search_field.bind("keyup.chosen",function(e){t.keyup_checker(e)}),this.search_field.bind("keydown.chosen",function(e){t.keydown_checker(e)}),this.search_field.bind("focus.chosen",function(e){t.input_focus(e)}),this.search_field.bind("cut.chosen",function(e){t.clipboard_event_checker(e)}),this.search_field.bind("paste.chosen",function(e){t.clipboard_event_checker(e)}),this.is_multiple?this.search_choices.bind("click.chosen",function(e){t.choices_click(e)}):this.container.bind("click.chosen",function(e){e.preventDefault()})},t.prototype.destroy=function(){return l(this.container[0].ownerDocument).unbind("click.chosen",this.click_test_action),this.search_field[0].tabIndex&&(this.form_field_jq[0].tabIndex=this.search_field[0].tabIndex),this.container.remove(),this.form_field_jq.removeData("chosen"),this.form_field_jq.show()},t.prototype.search_field_disabled=function(){return this.is_disabled=this.form_field_jq[0].disabled,this.is_disabled?(this.container.addClass("chosen-disabled"),this.search_field[0].disabled=!0,this.is_multiple||this.selected_item.unbind("focus.chosen",this.activate_action),this.close_field()):(this.container.removeClass("chosen-disabled"),this.search_field[0].disabled=!1,this.is_multiple?void 0:this.selected_item.bind("focus.chosen",this.activate_action))},t.prototype.container_mousedown=function(e){if(!this.is_disabled&&(e&&"mousedown"===e.type&&!this.results_showing&&e.preventDefault(),null==e||!l(e.target).hasClass("search-choice-close")))return this.active_field?this.is_multiple||!e||l(e.target)[0]!==this.selected_item[0]&&!l(e.target).parents("a.chosen-single").length||(e.preventDefault(),this.results_toggle()):(this.is_multiple&&this.search_field.val(""),l(this.container[0].ownerDocument).bind("click.chosen",this.click_test_action),this.results_show()),this.activate_field()},t.prototype.container_mouseup=function(e){if("ABBR"===e.target.nodeName&&!this.is_disabled)return this.results_reset(e)},t.prototype.search_results_mousewheel=function(e){var t;if(e.originalEvent&&(t=-e.originalEvent.wheelDelta||e.originalEvent.detail),null!=t)return e.preventDefault(),"DOMMouseScroll"===e.type&&(t*=40),this.search_results.scrollTop(t+this.search_results.scrollTop())},t.prototype.blur_test=function(e){if(!this.active_field&&this.container.hasClass("chosen-container-active"))return this.close_field()},t.prototype.close_field=function(){return l(this.container[0].ownerDocument).unbind("click.chosen",this.click_test_action),this.active_field=!1,this.results_hide(),this.container.removeClass("chosen-container-active"),this.clear_backstroke(),this.show_search_field_default(),this.search_field_scale()},t.prototype.activate_field=function(){this.container.addClass("chosen-container-active"),this.active_field=!0,this.search_field.val(this.search_field.val())},t.prototype.test_active_click=function(e){var t;return(t=l(e.target).closest(".chosen-container")).length&&this.container[0]===t[0]?this.active_field=!0:this.close_field()},t.prototype.results_build=function(){return this.parsing=!0,this.selected_option_count=null,this.results_data=r.select_to_array(this.form_field),this.is_multiple?this.search_choices.find("li.search-choice").remove():this.is_multiple||(this.single_set_selected_text(),this.disable_search||this.form_field.options.length<=this.disable_search_threshold?(this.search_field[0].readOnly=!0,this.container.addClass("chosen-container-single-nosearch")):(this.search_field[0].readOnly=!1,this.container.removeClass("chosen-container-single-nosearch"))),this.update_results_content(this.results_option_build({first:!0})),this.search_field_disabled(),this.show_search_field_default(),this.search_field_scale(),this.parsing=!1},t.prototype.result_do_highlight=function(e,t){var i,s,o,a,r,n,l=-1;e.length&&(this.result_clear_highlight(),this.result_highlight=e,this.result_highlight.addClass("highlighted"),o=parseInt(this.search_results.css("maxHeight"),10),n=this.result_highlight.outerHeight(),a=o+(r=this.search_results.scrollTop()),i=(s=this.result_highlight.position().top+this.search_results.scrollTop())+n,this.middle_highlight&&(t||"always"===this.middle_highlight||a<=i||s<r)?l=Math.min(s-n,Math.max(0,s-(o-n)/2)):a<=i?l=0<i-o?i-o:0:s<r&&(l=s),-1<l&&this.search_results.scrollTop(l))},t.prototype.result_clear_highlight=function(){return this.result_highlight&&this.result_highlight.removeClass("highlighted"),this.result_highlight=null},t.prototype.results_show=function(){if(this.is_multiple&&this.max_selected_options<=this.choices_count())return this.form_field_jq.trigger("chosen:maxselected",{chosen:this}),!1;this.container.addClass("chosen-with-drop"),this.results_showing=!0,this.search_field.focus(),this.search_field.val(this.search_field.val()),this.winnow_results(1);var e=this.drop_direction;if("auto"===e)if(this.drop_directionFixed)e=this.drop_directionFixed;else{var t=this.container.find(".chosen-drop");this.container.offset().top+t.outerHeight()+30>l(window).height()+l(window).scrollTop()&&(e="up"),this.drop_directionFixed=e}return this.container.toggleClass("chosen-up","up"===e),this.form_field_jq.trigger("chosen:showing_dropdown",{chosen:this})},t.prototype.update_results_content=function(e){return this.search_results.html(e)},t.prototype.results_hide=function(){return this.results_showing&&(this.result_clear_highlight(),this.container.removeClass("chosen-with-drop"),this.form_field_jq.trigger("chosen:hiding_dropdown",{chosen:this}),this.drop_directionFixed=0),this.results_showing=!1},t.prototype.set_tab_index=function(e){var t;if(this.form_field.tabIndex)return t=this.form_field.tabIndex,this.form_field.tabIndex=-1,this.search_field[0].tabIndex=t},t.prototype.set_label_behavior=function(){var t=this;if(this.form_field_label=this.form_field_jq.parents("label"),!this.form_field_label.length&&this.form_field.id.length&&(this.form_field_label=l("label[for='"+this.form_field.id+"']")),0<this.form_field_label.length)return this.form_field_label.bind("click.chosen",function(e){return t.is_multiple?t.container_mousedown(e):t.activate_field()})},t.prototype.show_search_field_default=function(){return this.is_multiple&&this.choices_count()<1&&!this.active_field?(this.search_field.val(this.default_text),this.search_field.addClass("default")):(this.search_field.val(""),this.search_field.removeClass("default"))},t.prototype.search_results_mouseup=function(e){var t;(t=l(e.target).hasClass("active-result")?l(e.target):l(e.target).parents(".active-result").first()).length&&(this.result_highlight=t,this.result_select(e))},t.prototype.search_results_mouseover=function(e){var t;if(t=l(e.target).hasClass("active-result")?l(e.target):l(e.target).parents(".active-result").first())return this.result_do_highlight(t)},t.prototype.search_results_mouseout=function(e){if(l(e.target).hasClass("active-result"))return this.result_clear_highlight()},t.prototype.choice_build=function(e){var t,i,s=this;return t=l("<li />",{class:"search-choice"}).html("<span title='"+e.html+"'>"+e.html+"</span>"),e.disabled?t.addClass("search-choice-disabled"):((i=l("<a />",{class:"search-choice-close","data-option-array-index":e.array_index})).bind("click.chosen",function(e){return s.choice_destroy_link_click(e)}),t.append(i)),this.search_container.before(t)},t.prototype.choice_destroy_link_click=function(e){if(e.preventDefault(),e.stopPropagation(),!this.is_disabled)return this.choice_destroy(l(e.target))},t.prototype.choice_destroy=function(e){if(this.result_deselect(e[0].getAttribute("data-option-array-index")))return this.show_search_field_default(),this.is_multiple&&0<this.choices_count()&&this.search_field.val().length<1&&this.results_hide(),e.parents("li").first().remove(),this.search_field_scale()},t.prototype.results_reset=function(){if(this.reset_single_select_options(),this.form_field.options[0].selected=!0,this.single_set_selected_text(),this.show_search_field_default(),this.results_reset_cleanup(),this.form_field_jq.trigger("change"),this.active_field)return this.results_hide()},t.prototype.results_reset_cleanup=function(){return this.current_selectedIndex=this.form_field.selectedIndex,this.selected_item.find("abbr").remove()},t.prototype.result_select=function(e){var t,i;if(this.result_highlight)return t=this.result_highlight,this.result_clear_highlight(),this.is_multiple&&this.max_selected_options<=this.choices_count()?(this.form_field_jq.trigger("chosen:maxselected",{chosen:this}),!1):(this.is_multiple?t.removeClass("active-result"):this.reset_single_select_options(),(i=this.results_data[t[0].getAttribute("data-option-array-index")]).selected=!0,this.form_field.options[i.options_index].selected=!0,this.selected_option_count=null,this.is_multiple?this.choice_build(i):this.single_set_selected_text(i.text),(e.metaKey||e.ctrlKey)&&this.is_multiple||this.results_hide(),this.search_field.val(""),(this.is_multiple||this.form_field.selectedIndex!==this.current_selectedIndex)&&this.form_field_jq.trigger("change",{selected:this.form_field.options[i.options_index].value}),this.current_selectedIndex=this.form_field.selectedIndex,this.search_field_scale())},t.prototype.single_set_selected_text=function(e){return null==e&&(e=this.default_text),e===this.default_text?this.selected_item.addClass("chosen-default"):(this.single_deselect_control_build(),this.selected_item.removeClass("chosen-default")),this.selected_item.find("span").attr("title",e).text(e)},t.prototype.result_deselect=function(e){var t;return t=this.results_data[e],!this.form_field.options[t.options_index].disabled&&(t.selected=!1,this.form_field.options[t.options_index].selected=!1,this.selected_option_count=null,this.result_clear_highlight(),this.results_showing&&this.winnow_results(),this.form_field_jq.trigger("change",{deselected:this.form_field.options[t.options_index].value}),this.search_field_scale(),!0)},t.prototype.single_deselect_control_build=function(){if(this.allow_single_deselect)return this.selected_item.find("abbr").length||this.selected_item.find("span").first().after('<abbr class="search-choice-close"></abbr>'),this.selected_item.addClass("chosen-single-with-deselect")},t.prototype.get_search_text=function(){return this.search_field.val()===this.default_text?"":l("<div/>").text(l.trim(this.search_field.val())).html()},t.prototype.winnow_results_set_highlight=function(e){var t,i;if(null!=(t=(i=this.is_multiple?[]:this.search_results.find(".result-selected.active-result")).length?i.first():this.search_results.find(".active-result").first()))return this.result_do_highlight(t,e)},t.prototype.no_results=function(e){var t;return(t=l('<li class="no-results">'+this.results_none_found+' "<span></span>"</li>')).find("span").first().html(e),this.search_results.append(t),this.form_field_jq.trigger("chosen:no_results",{chosen:this})},t.prototype.no_results_clear=function(){return this.search_results.find(".no-results").remove()},t.prototype.keydown_arrow=function(){var e;return this.results_showing&&this.result_highlight?(e=this.result_highlight.nextAll("li.active-result").first())?this.result_do_highlight(e):void 0:this.results_show()},t.prototype.keyup_arrow=function(){var e;return this.results_showing||this.is_multiple?this.result_highlight?(e=this.result_highlight.prevAll("li.active-result")).length?this.result_do_highlight(e.first()):(0<this.choices_count()&&this.results_hide(),this.result_clear_highlight()):void 0:this.results_show()},t.prototype.keydown_backstroke=function(){var e;return this.pending_backstroke?(this.choice_destroy(this.pending_backstroke.find("a").first()),this.clear_backstroke()):(e=this.search_container.siblings("li.search-choice").last()).length&&!e.hasClass("search-choice-disabled")?(this.pending_backstroke=e,this.single_backstroke_delete?this.keydown_backstroke():this.pending_backstroke.addClass("search-choice-focus")):void 0},t.prototype.clear_backstroke=function(){return this.pending_backstroke&&this.pending_backstroke.removeClass("search-choice-focus"),this.pending_backstroke=null},t.prototype.keydown_checker=function(e){var t,i;switch(t=null!=(i=e.which)?i:e.keyCode,this.search_field_scale(),8!==t&&this.pending_backstroke&&this.clear_backstroke(),t){case 8:this.backstroke_length=this.search_field.val().length;break;case 9:this.results_showing&&!this.is_multiple&&this.result_select(e),this.mouse_on_container=!1;break;case 13:e.preventDefault();break;case 38:e.preventDefault(),this.keyup_arrow();break;case 40:e.preventDefault(),this.keydown_arrow()}},t.prototype.search_field_scale=function(){var e,t,i,s,o,a,r,n;if(this.is_multiple){for(s="position:absolute; left: -1000px; top: -1000px; display:none;",r=a=0,n=(o=["font-size","font-style","font-weight","font-family","line-height","text-transform","letter-spacing"]).length;r<n;r++)s+=(i=o[r])+":"+this.search_field.css(i)+";";return(e=l("<div />",{style:s})).text(this.search_field.val()),l("body").append(e),a=e.width()+25,e.remove(),(t=this.container.outerWidth())-10<a&&(a=t-10),this.search_field.css({width:a+"px"})}},t}()}).call(this)}),define("config/config",[],function(require,exports,module){"use strict";var e,t,i,s,o=seajs.data.vars._DEVELOPER;switch(seajs.data.vars._ENV){case 0:e=".i7391.com/",i="1000004",s="http://manageweb.i7391.com/",t="http://api-tools.i7391.com/";break;case-1:switch(e=".7391test.com/",o){case"qiujm":t="http://tools.lik.7391test.com/",i="1000011",s="http://manageweb.qiujm.7391test.com/";break;case"lik":t="http://tools.lik.7391test.com/",i="1000002",s="http://manageweb.lik.7391test.com/"}break;case-2:e=".7391test.com/",i="1000005",s="http://manageweb.7391test.com/",t="http://api-tools.7391test.com/"}console.log(t),exports.WORK_WECHAT_AGENTID=i,exports.WORK_WECHAT_RETURN_URL=s+"login_cb.html",exports.DOMAIN_SITE=e.slice,exports.API_TOOLS_SITE=t,exports.REQUEST_URL={LOGIN:t+"passport/work_wechat_callback.html",LOGOUT:t+"passport/logout.html",UPLOAD:t+"i7391_CMS/common/upload.html",MENU_LIST:t+"common/get_menu_list.html",GROUP_LIST:t+"admin/group_list.html",GROUP_ADD:t+"admin/group_add.html",GROUP_EDIT:t+"admin/group_edit.html",GROUP_DELETE:t+"admin/group_delete.html",GET_GROUP_INFO:t+"admin/group_edit.html?action=getGroupInfo",JQ_GET_DATA:t+"admin/group_authority_edit.html?action=jqGetData",GROUP_AUTHORITY_EIDT:t+"admin/group_authority_edit.html",ADMIN_LIST:t+"admin/admin_list.html",ADMIN_ADD:t+"admin/admin_add.html",ADMIN_EDIT:t+"admin/admin_edit.html",ADMIN_DELETE:t+"admin/admin_delete.html",ADMIN_WX_BIND:t+"wxqr/admin_bind.html",ADMIN_WX_UNBIND:t+"admin/wx_unbind.html",GET_ADMIN_INFO:t+"admin/admin_edit.html?action=getAdminInfo",GET_GROUP_LIST:t+"admin/admin_add.html?action=getGroupList",BANNER_LOGIN_LIST:t+"i7391_CMS/banner_pc/banner_login_list.html",BANNER_LOGIN_ADD:t+"i7391_CMS/banner_pc/banner_login_add.html",BANNER_LOGIN_EDIT:t+"i7391_CMS/banner_pc/banner_login_edit.html",BANNER_LOGIN_DELETE:t+"i7391_CMS/banner_pc/banner_login_delete.html",GET_BANNER_INFO:t+"i7391_CMS/banner_pc/banner_login_edit.html?action=getBannerInfo",BANNER_LOGIN_FOOTER_LIST:t+"i7391_CMS/banner_pc/banner_login_footer_list.html",BANNER_LOGIN_FOOTER_ADD:t+"/i7391_CMS/banner_pc/banner_login_footer_add.html",BANNER_LOGIN_FOOTER_EDIT:t+"/i7391_CMS/banner_pc/banner_login_footer_edit.html",BANNER_LOGIN_FOOTER_DELETE:t+"/i7391_CMS/banner_pc/banner_login_footer_delete.html",GET_FOOTER_INFO:t+"i7391_CMS/banner_pc/banner_login_footer_edit.html?action=getBannerInfo",CAROUSEL_LIST:t+"i7391_CMS/carousel/carousel_list.html",CAROUSEL_ADD:t+"i7391_CMS/carousel/carousel_add.html",CAROUSEL_EDIT:t+"i7391_CMS/carousel/carousel_edit.html",CAROUSEL_DELETE:t+"i7391_CMS/carousel/carousel_delete.html",GET_CAROUSEL_INFO:t+"i7391_CMS/carousel/carousel_edit.html?action=getCarouselInfo",GAME_LIST:t+"i7391_CMS/game/game_list.html",GAME_ADD:t+"i7391_CMS/game/game_add.html",GAME_EDIT:t+"i7391_CMS/game/game_edit.html",GAME_DELETE:t+"i7391_CMS/game/game_detele.html",GET_GAME_INFO:t+"i7391_CMS/game/game_edit.html?action=getGameInfo",POINTCARD_LIST:t+"i7391_CMS/pointcard/pointcard_list.html",POINTCARD_ADD:t+"i7391_CMS/pointcard/pointcard_add.html",POINTCARD_EDIT:t+"i7391_CMS/pointcard/pointcard_edit.html",POINTCARD_DELETE:t+"i7391_CMS/pointcard/pointcard_delete.html",GET_POINTCARD_INFO:t+"i7391_CMS/pointcard/pointcard_edit.html?action=getPointcardInfo",MOBILEGAME_LIST:t+"i7391_CMS/mobilegame/mobilegame_list.html",MOBILEGAME_ADD:t+"i7391_CMS/mobilegame/mobilegame_add.html",MOBILEGAME_EDIT:t+"i7391_CMS/mobilegame/mobilegame_edit.html",MOBILEGAME_DELETE:t+"i7391_CMS/mobilegame/mobilegame_delete.html",GET_MOBILEGAME_INFO:t+"i7391_CMS/mobilegame/mobilegame_edit.html?action=getMobileGameInfo",GOODS_LIST:t+"i7391_CMS/goods/goods_list.html",GOODS_ADD:t+"i7391_CMS/goods/goods_add.html",GOODS_EDIT:t+"i7391_CMS/goods/goods_edit.html",GOODS_DELETE:t+"i7391_CMS/goods/goods_detele.html",GET_GOODS_INFO:t+"i7391_CMS/goods/goods_edit.html?action=getGoodsInfo",GOODS_PC_LIST:t+"i7391_CMS/goods_pc/goods_list.html",GOODS_PC_ADD:t+"i7391_CMS/goods_pc/goods_add.html",GOODS_PC_EDIT:t+"i7391_CMS/goods_pc/goods_edit.html",GOODS_PC_DELETE:t+"i7391_CMS/goods_pc/goods_detele.html",GET_GOODS_PC_INFO:t+"i7391_CMS/goods_pc/goods_edit.html?action=getGoodsInfo",GET_RECORD:t+"8591/contrast/game_contrast.html?action=getRecord",GAME_CONTRAST:t+"8591/contrast/game_contrast.html",GET_ALLGAME_DATA:t+"i7391_API/getdata/get_allgame_data.html",GET_GAMETYPE_DATA:t+"i7391_API/getdata/get_gametype_data",GET_RATE:t+"i7391_API/getdata/get_rate.html",GET_CARD_CATEGORY:t+"i7391_API/getdata/get_card_category.html",GET_CARD_POINT:t+"i7391_API/getdata/get_card_point.html",CLEAN_DATA:"http://117.27.250.72:8081/_clean/res.php"}}),define("config/function",["jquery","zui","config/config","lib/cookie"],function(require,exports,module){"use strict";var a=require("jquery");require("zui");var e=require("config/config"),r=require("lib/cookie");a.ajaxSetup({error:function(e,t,i){var s="介面出錯: "+e.status;s+="<br /> 介面: "+this.url,s+="<br /> 方式: "+this.type,s+="<br /> 資料: "+this.data,o.show(s)},beforeSend:function(e){a("#ajax_loading").removeClass("hidden").addClass("show")},complete:function(e,t){a("#ajax_loading").removeClass("show").addClass("hidden")}}),a(document).on("click","a",function(e){e.preventDefault()});exports.show_btn=function(){for(var e=a(".power"),t=0;t<e.length;t++){var i="/"==e[t].getAttribute("data-link")?e[t].getAttribute("data-link"):"/"+e[t].getAttribute("data-link");r(i)==i?a('[data-link="'+i+'"]').removeClass("hidden"):a('[data-link="'+i+'"]').remove()}},a(document).on("click",'.datagrid-row:not(".datagrid-row-head"):not("#triggerModal .datagrid-row")',function(){0==a(this).find(".che").hasClass("checked")?(a(this).find(".che").addClass("checked"),a(this).addClass("active")):(a(this).find(".che").removeClass("checked"),a(this).removeClass("active")),a(".che").length==a(".che.checked").length?a("#checkAll").addClass("checked"):a("#checkAll").removeClass("checked")}),a(document).on("click",".datagrid-row-head .datagrid-cell-index",function(){0==a(this).find("#checkAll").hasClass("checked")?(a(this).find("#checkAll").addClass("checked"),a(".che").addClass("checked"),a(".che").parents(".datagrid-row").addClass("active")):(a(this).find("#checkAll").removeClass("checked"),a(".che").removeClass("checked"),a(".che").parents(".datagrid-row").removeClass("active"))}),a(document).keydown(function(e){switch(e.keyCode){case 13:case 32:return!1}}),a(document).on("input porpertychange change",'input[type="text"]',function(e){a(this).tooltip("destroy");var t=a('input[type="text"]');""==a(this).val()&&a(this).tooltip("show","請填寫"+a(this).next().html());for(var i=0;i<t.length;i++){if(""==t[i].value){a(".up").addClass("disabled");break}a(".up").removeClass("disabled")}});exports.get_search_data=function(e,t,i){a(document).on("click",".search-button",function(){n(e,t,i)})};var n=function(i,e,s){var o={page:1,rows:e,searchField:a(".chosen-select").val(),searchOper:"cn",searchString:a("input.search-control").val(),_search:!0};a.ajax({type:"GET",url:i,dataType:"json",data:o,xhrFields:{withCredentials:!0},crossDomain:!0,success:function(e){if(e.records&&e.records>o.rows){var t=o.rows+=1e3;return n(i,t,s),!1}a.isFunction(s)&&l(s(e))}})};exports.search_data=n;var l=function(e){var t=parseInt(a('li[class="active"] .pager-item').html()),i=a("#datagridPageExample").data("zui.datagrid");i.setDataSource(e),i.render(),a("#datagridPageExample").on("onRender",function(e){i.setPager(t||1)})};exports.change_page=l;exports.show_picture_upload=function(){return'<div id="tableUploader" class="uploader"><div class="uploader-message text-center"><div class="content"></div><button type="button" class="close">×</button></div><table class="table table-bordered"><thead><tr><th colspan="2">檔名</th><th style="width: 100px">大小</th><th style="width: 160px; text-align: center;">狀態/操作</th></tr></thead><tbody class="uploader-files"><tr class="file template"><td style="width: 38px; padding: 3px"><div class="file-icon"></div></td><td style="padding: 0"><div style="position: relative; padding: 8px;"><strong class="file-name"></strong><div class="file-progress-bar"></div></div></td><td><span class="file-size text-muted"></span></td><td class="actions text-right" style="padding: 0 4px;"><div class="file-status" data-toggle="tooltip" style="margin: 8px;"><i class="icon"></i> <span class="text"></span></div><a data-toggle="tooltip" class="btn btn-link btn-download-file" target="_blank"><i class="icon icon-download-alt"></i></a><button type="button" data-toggle="tooltip" class="btn btn-link btn-reset-file" title="Repeat"><i class="icon icon-repeat"></i></button><button type="button" data-toggle="tooltip" class="btn btn-link btn-rename-file" title="Rename"><i class="icon icon-pencil"></i></button><button type="button" data-toggle="tooltip" title="Remove" class="btn btn-link btn-delete-file"><i class="icon icon-trash text-danger"></i></button></td></tr></tbody><tfoot><tr><td colspan="4" style="padding: 4px 0"><div style="position: relative;"><div class="uploader-status pull-right text-muted" style="margin-top: 5px;"></div><button type="button" class="btn btn-link uploader-btn-browse"><i class="icon icon-plus"></i> 選擇檔案</button><button type="button" class="btn btn-link uploader-btn-start"><i class="icon icon-cloud-upload"></i> 開始上傳</button></div></td></tr></tfoot></table></div>'};exports.show_upload_options=function(){a("#tableUploader").uploader({url:e.REQUEST_URL.UPLOAD,lang:"zh_tw",filters:{mime_types:[{title:"圖片",extensions:"jpg,gif,png"}]},limitFilesCount:1,deleteActionOnDone:function(e,t){t()},onFileUploaded:function(e,t){var i=JSON.parse(t.response);a("#imgUrlInput").val(i.data)}})};exports.show_chosen=function(e){for(var t="<option value=''></option>",i=0;i<e.length;i++)t+="<option value="+e[i].key+">"+e[i].value+"</option>";a("select.chosen-select").html(t),a("select.chosen-select").chosen({lang:"zh_cn",no_results_text:"沒有找到",disable_search_threshold:10,search_contains:!0})};exports.show_picture_tooltip=function(){a(document).on("mouseover",".pic-show:not(:eq(0))",function(){a(this).tooltip("destroy");var e=a(this).html(),t=/^\/\//;!0===t.test(e)&&(e=e.replace(t,"http://"));var i="<img src="+e+' class="img-rounded">';a('[data-toggle="tooltip"]').tooltip({container:"#datagridPageExample",placement:"right",html:!0,title:i}),a(this).tooltip("show",i)})};var o=new a.zui.Messager("",{type:"danger",icon:"exclamation-sign",cssClass:"my-messager",contentClass:"my-messager-content",placement:"center",time:!0===seajs.data.debug?1e4:4e3});exports.get_user_i7391_cookie=function(e){var t=[],i=r("User_Cookie_Name");if(null===i||""===i)return!1;var s=i.split("&");for(var o in s){var a=s[o].split("=");t[a[0]]=a[1]}return void 0!==t[e]&&t[e]},exports.getUrlParam=function(e){var t=window.location.hash.match(new RegExp("(?:#|&)"+e+"=([^&]*)(&|$)"));return(t?decodeURIComponent(t[1]):"")||function(e,t){t||(t=window.location.href);e=e.replace(/[\[\]]/g,"\\$&");var i=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)").exec(t);return i?i[2]?decodeURIComponent(i[2].replace(/\+/g," ")):"":null}(e)};exports.show_error_tip=function(e){var t=e;new a.zui.Messager({type:"danger",time:2e3,close:!1}).show(t)};exports.show_success_tip=function(e){var t=e;new a.zui.Messager({type:"success",time:2e3,close:!1}).show(t)};exports.delete_all_cookie=function(){for(var e=document.cookie.split(";"),t=0;t<e.length;t++){var i=-1<(o=(s=e[t]).indexOf("="))?s.substr(0,o):s;document.cookie=i+"=;expires=Thu, 01 Jan 1970 00:00:00 GMT; path=/"}if(0<e.length)for(t=0;t<e.length;t++){i=-1<(o=(s=e[t]).indexOf("="))?s.substr(0,o):s;var s,o,a=location.host.substr(location.host.indexOf("."));document.cookie=i+"=;expires=Thu, 01 Jan 1970 00:00:00 GMT; path=/; domain="+a}}}),define("lib/cookie",["jquery"],function(require,exports,module){"use strict";var u=require("jquery");module.exports=function(e,t,i){if(void 0===t){var s=null;if(document.cookie&&""!==document.cookie)for(var o=document.cookie.split(";"),a=0;a<o.length;a++){var r=u.trim(o[a]);if(r.substring(0,e.length+1)==e+"="){s=decodeURIComponent(r.substring(e.length+1));break}}return s}i=i||{},null===t&&(t="",i.expires=-1);var n,l="";i.expires&&("number"==typeof i.expires||i.expires.toUTCString)&&("number"==typeof i.expires?(n=new Date).setTime(n.getTime()+24*i.expires*60*60*1e3):n=i.expires,l="; expires="+n.toUTCString());var c=i.path?"; path="+i.path:"",d=i.domain?"; domain="+i.domain:"",h=i.secure?"; secure":"";document.cookie=[e,"=",encodeURIComponent(t),l,c,d,h].join("")}});