define("admin/group_list/group_list",["jquery","zui","grids","board","config/config","config/function","config/cookie"],function(require,exports,module){"use strict";var h=require("jquery");require("zui"),require("grids"),require("board");var l=require("config/config"),i=require("config/function"),t=(require("config/cookie"),{init:function(){o(),r(),c(),_(),g(),E(),T(),D(),e()}}),e=function(o){var t={page:1,rows:o=o||0};h.ajax({type:"GET",url:l.REQUEST_URL.GROUP_LIST,dataType:"json",data:t,xhrFields:{withCredentials:!0},crossDomain:!0,success:function(t){t.records>o?(e(o+=100),console.log(o)):(console.log(t),n(t))}})},a=function(){var a=[];h.ajax({type:"GET",url:l.REQUEST_URL.GROUP_LIST,dataType:"json",data:{page:1,rows:1e3},xhrFields:{withCredentials:!0},crossDomain:!0,success:function(t){for(var o=t.rows,e=0;e<o.length;e++){var n=1==o[e].cell.Status?"啟用":"禁用",i={GroupName:o[e].cell.GroupName,Status:n,GroupInfo:o[e].cell.GroupInfo,option:'<div class="btn-group"><button data-id='+o[e].cell.Id+' href="/admin/group_edit" class="power btn edit">編輯</button><button data-id='+o[e].cell.Id+' href="/admin/group_delete" class="power btn del">刪除</button><button data-id='+o[e].cell.Id+' href="/admin/group_authority_edit" class="power btn auth">許可權</button></div>'};a.push(i)}}});var o=parseInt(h('li[class="active"] .pager-item').html()),e=h("#datagridPageExample").data("zui.datagrid");e.setDataSource(a),e.render(),h("#datagridPageExample").on("onRender",function(t){e.setPager(o||1)})},n=function(t){for(var o=t.rows,e=[],n=0;n<o.length;n++){var i=1==o[n].cell.Status?"啟用":"禁用",a={GroupName:o[n].cell.GroupName,Status:i,GroupInfo:o[n].cell.GroupInfo,option:'<div class="btn-group"><button data-id='+o[n].cell.Id+' href="/admin/group_edit" class="power btn edit">編輯</button><button data-id='+o[n].cell.Id+' href="/admin/group_delete" class="power btn del">刪除</button><button data-id='+o[n].cell.Id+' href="/admin/group_authority_edit" class="power btn auth">許可權</button></div>'};e.push(a)}h("#datagridPageExample").datagrid({dataSource:{cols:[{name:"GroupName",label:"管理員組名稱"},{name:"Status",label:"狀態"},{name:"GroupInfo",label:"組描述"},{name:"option",label:"操作",html:!0}],array:e},states:{pager:{page:1,recPerPage:15}},configs:{R0C0:{label:'<input type="checkbox" id="checkAll">',html:!0},C0:{label:'<input type="checkbox" class="che">',html:!0}},sortable:!0,height:"page"})},o=function(){h(document).on("click",'[href="admin/group_add"]',function(t){s()})},s=function(){new h.zui.ModalTrigger({width:"auto",height:"auto",className:"in_auto",title:"新增管理員組",custom:'<div class="input-control has-label-left-lg"><input id="groupNameInput" type="text" class="form-control" placeholder=""><label for="groupNameInput" class="input-control-label-left text-right">管理員組名稱</label></div><div class="input-control has-label-left-lg"><input id="groupInfoInput" type="text" class="form-control" placeholder=""><label for="groupinfoInput" class="input-control-label-left text-right">組描述</label></div><div class="switch"><input id="groupCheckInput" type="checkbox"><label>啟用</label></div><button id="groupAddButton" class="btn btn-block btn-primary disabled up" type="button">新增</button>',backdrop:"static"}).show()},r=function(){h(document).on("click","#groupAddButton",function(){h("#groupAddButton").addClass("disabled"),h(document).off("click","#groupAddButton"),d(i.show_success_tip,i.show_error_tip)})},d=function(o,e){var t={groupName:h("#groupNameInput").val(),groupInfo:h("#groupInfoInput").val(),status:1==h("#groupCheckInput").prop("checked")?1:0};h.ajax({type:"POST",url:l.REQUEST_URL.GROUP_ADD,dataType:"json",data:t,xhrFields:{withCredentials:!0},crossDomain:!0,success:function(t){!0===t.status?(h.isFunction(o)&&o(t.info),a()):h.isFunction(e)&&e(t.info),h("#groupAddButton").removeClass("disabled"),h(document).on("click","#groupAddButton",function(){h("#groupAddButton").addClass("disabled"),h(document).off("click","#groupAddButton"),d(i.show_success_tip,i.show_error_tip)})}})},c=function(){h(document).on("click",".edit",function(t){t.stopPropagation();var o=h(this).attr("data-id");u(o,p,i.show_error_tip)})},u=function(t,o,e){var n={groupId:t};h.ajax({type:"GET",url:l.REQUEST_URL.GET_GROUP_INFO,dataType:"json",data:n,xhrFields:{withCredentials:!0},crossDomain:!0,success:function(t){!0===t.status?h.isFunction(o)&&o(t):h.errorFunction(o)&&e(t.info)}})},p=function(t){var o=t.data,e=1==o.Status?"checked":"",n='<div class="input-control has-label-left-lg"><input id="groupNameInput" type="text" class="form-control" value='+o.GroupName+' placeholder=""><label for="groupNameInput" class="input-control-label-left text-right">管理員組名稱</label></div><div class="input-control has-label-left-lg"><input id="groupInfoInput" type="text" class="form-control" value='+o.GroupInfo+' placeholder=""><label for="groupinfoInput" class="input-control-label-left text-right">組描述</label></div><div class="switch"><input id="groupCheckInput" type="checkbox" '+e+'><label>啟用</label></div><button id="groupEditButton" data-id='+o.Id+' class="btn btn-block btn-primary up" type="button">儲存</button>';new h.zui.ModalTrigger({width:"auto",height:"auto",className:"in_auto",title:"編輯管理員組",custom:n,backdrop:"static"}).show()},_=function(){h(document).on("click","#groupEditButton",function(){var t=h(this).attr("data-id");m(t,i.show_success_tip,i.show_error_tip)})},m=function(t,o,e){var n={groupId:t,groupName:h("#groupNameInput").val(),groupInfo:h("#groupInfoInput").val(),status:1==h("#groupCheckInput").prop("checked")?1:0};h.ajax({type:"POST",url:l.REQUEST_URL.GROUP_EDIT,dataType:"json",data:n,xhrFields:{withCredentials:!0},crossDomain:!0,success:function(t){!0===t.status?(h.isFunction(o)&&o(t.info),a()):h.isFunction(e)&&e(t.info)}})},g=function(){h(document).on("click",".del",function(t){t.stopPropagation();var o=h(this).attr("data-id");f(o)}),b()},b=function(){h(document).on("click","#confirm",function(){var t=h(this).attr("data-id");I(t,i.show_success_tip,i.show_error_tip)}),h(document).on("click","#cancel",function(){})},f=function(t){var o='<h4>確認要刪除嗎?</h4><hr/><button type="button" data-id='+t+' data-dismiss="modal" id="confirm" class="btn btn-block btn-primary">確定</button><button type="button" data-dismiss="modal" id="cancel" class="btn btn-block btn-primary">取消</button>';new h.zui.ModalTrigger({width:"300px",height:"auto",className:"in_auto",title:"刪除管理員組",custom:o,backdrop:"static"}).show()},I=function(t,o,e){var n={idString:t};h.ajax({type:"GET",url:l.REQUEST_URL.GROUP_DELETE,dataType:"json",data:n,xhrFields:{withCredentials:!0},crossDomain:!0,success:function(t){!0===t.status?(h.isFunction(o)&&o(t.info),a()):h.isFunction(e)&&e(t.info)}})},E=function(){h(document).on("click",'a[href="admin/group_delete"]',function(t){v()}),h(document).on("click","#continue",function(){for(var t=h(".che:checked").parents(".datagrid-row").find(".del"),o=[],e=0;e<t.length;e++)o.push(parseInt(t[e].getAttribute("data-id")));if(0===o.length)return i.show_error_tip("請選擇要刪除的組"),!1;I(o.toString(),i.show_success_tip,i.show_error_tip)})},v=function(){new h.zui.ModalTrigger({width:"300px",height:"auto",className:"in_auto",title:"刪除管理員組",custom:'<h4>確認要刪除所選的管理組嗎?</h4><hr/><button type="button" data-dismiss="modal" id="continue" class="btn btn-block btn-primary">確定</button><button type="button" data-dismiss="modal" id="cancel" class="btn btn-block btn-primary">取消</button>',backdrop:"static"}).show()},T=function(){h(document).on("click",".auth",function(t){t.stopPropagation();var o=h(this).attr("data-id");S(o,A,i.show_error_tip)})},S=function(o,e,n){var t={groupId:o};h.ajax({type:"GET",url:l.REQUEST_URL.JQ_GET_DATA,dataType:"json",data:t,xhrFields:{withCredentials:!0},crossDomain:!0,success:function(t){!0===t.status?h.isFunction(e)&&e(t,o):h.isFunction(n)&&n(t.info)}})},A=function(t,o){var e='<div class="boards" id="myBoards" style="height:500px;overflow: scroll;"><div class="board panel"><div class="panel-heading"><strong>已啟用</strong></div><div class="panel-body"><div class="board-list" id="open"></div></div></div><div class="board panel"><div class="panel-heading"><strong>未啟用</strong></div><div class="panel-body"><div class="board-list" id="close"></div></div></div></div><button id="editButton" data-id='+o+' class="btn btn-primary btn-block" type="button">提交</button>';new h.zui.ModalTrigger({width:"auto",height:"auto",className:"in_auto",title:"編輯管理員組許可權",custom:e,backdrop:"static"}).show(),O(t)},O=function(t){var o=t.data,e=o.groupAllPerm,n=o.groupPerm,i=[],a=[],l=[],s=[];for(var r in e)i.push(e[r].action);for(var d=0;d<i.length;d++)for(var c=0;c<i[d].length;c++){var u={Id:i[d][c].Id,ActionName:i[d][c].ActionName};l.push(u)}for(var r in n)a.push(n[r].action);for(d=0;d<a.length;d++)for(c=0;c<a[d].length;c++){var p={Id:a[d][c].Id,ActionName:a[d][c].ActionName};s.push(p)}var _=C(s,l),m="";for(d=0;d<_.length;d++)m+="<div data-id="+_[d].Id+' class="board-item">'+_[d].ActionName+"</div>";h("#close").html(m);var g="";for(d=0;d<s.length;d++)g+="<div data-id="+s[d].Id+' class="board-item">'+s[d].ActionName+"</div>";h("#open").html(g),h("#myBoards").boards({drop:function(t){},lang:"zh_tw"}),h(document).on("click",'#open .board-item:not(".board-item-shadow"):not(".board-item-empty")',function(){h("#close").append(h(this))}),h(document).on("click",'#close .board-item:not(".board-item-shadow"):not(".board-item-empty")',function(){h("#open").append(h(this))})},C=function(t,o){t.sort(function(t,o){return t.Id-o.Id}),o.sort(function(t,o){return t.Id-o.Id});for(var e=[],n=0;n<o.length;n++){for(var i=o[n],a=i.Id,l=!1,s=0;s<t.length;s++){if(t[s].Id==a){l=!0;break}}l||e.push(i)}return e},D=function(){h(document).on("click","#editButton",function(){for(var t=h(this).attr("data-id"),o=h('#open .board-item:not(".board-item-shadow"):not(".board-item-empty")'),e=[],n=0;n<o.length;n++)e.push(o[n].getAttribute("data-id"));y(t,e.toString(),i.show_success_tip,i.show_error_tip)})},y=function(t,o,e,n){var i={groupId:t,idString:o};h.ajax({type:"GET",url:l.REQUEST_URL.GROUP_AUTHORITY_EIDT,dataType:"json",data:i,xhrFields:{withCredentials:!0},crossDomain:!0,success:function(t){!0===t.status?h.isFunction(e)&&e(t.info):h.isFunction(n)&&n(t.info)}})};module.exports=t}),define("config/config",[],function(require,exports,module){"use strict";var t=seajs.data.vars._DOMIAN_SITE,o=seajs.data.vars._PASSPORT_SITE;exports.DOMAIN_SITE=t,exports.PASSPORT_SITE=o,exports.REQUEST_URL={LOGIN:o+"passport/work_wechat_callback.html",LOGOUT:o+"passport/logout.html",UPLOAD:o+"i7391_CMS/common/upload.html",MENU_LIST:o+"common/get_menu_list.html",GROUP_LIST:o+"admin/group_list.html",GROUP_ADD:o+"admin/group_add.html",GROUP_EDIT:o+"admin/group_edit.html",GROUP_DELETE:o+"admin/group_delete.html",GET_GROUP_INFO:o+"admin/group_edit.html?action=getGroupInfo",JQ_GET_DATA:o+"admin/group_authority_edit.html?action=jqGetData",GROUP_AUTHORITY_EIDT:o+"admin/group_authority_edit.html",ADMIN_LIST:o+"admin/admin_list.html",ADMIN_ADD:o+"admin/admin_add.html",ADMIN_EDIT:o+"admin/admin_edit.html",ADMIN_DELETE:o+"admin/admin_delete.html",ADMIN_WX_BIND:o+"wxqr/admin_bind.html",ADMIN_WX_UNBIND:o+"admin/wx_unbind.html",GET_ADMIN_INFO:o+"admin/admin_edit.html?action=getAdminInfo",GET_GROUP_LIST:o+"admin/admin_add.html?action=getGroupList",BANNER_LOGIN_LIST:o+"i7391_CMS/banner_pc/banner_login_list.html",BANNER_LOGIN_ADD:o+"i7391_CMS/banner_pc/banner_login_add.html",BANNER_LOGIN_EDIT:o+"i7391_CMS/banner_pc/banner_login_edit.html",BANNER_LOGIN_DELETE:o+"i7391_CMS/banner_pc/banner_login_delete.html",GET_BANNER_INFO:o+"i7391_CMS/banner_pc/banner_login_edit.html?action=getBannerInfo",BANNER_LOGIN_FOOTER_LIST:o+"i7391_CMS/banner_pc/banner_login_footer_list.html",BANNER_LOGIN_FOOTER_ADD:o+"/i7391_CMS/banner_pc/banner_login_footer_add.html",BANNER_LOGIN_FOOTER_EDIT:o+"/i7391_CMS/banner_pc/banner_login_footer_edit.html",BANNER_LOGIN_FOOTER_DELETE:o+"/i7391_CMS/banner_pc/banner_login_footer_delete.html",GET_FOOTER_INFO:o+"i7391_CMS/banner_pc/banner_login_footer_edit.html?action=getBannerInfo",CAROUSEL_LIST:o+"i7391_CMS/carousel/carousel_list.html",CAROUSEL_ADD:o+"i7391_CMS/carousel/carousel_add.html",CAROUSEL_EDIT:o+"i7391_CMS/carousel/carousel_edit.html",CAROUSEL_DELETE:o+"i7391_CMS/carousel/carousel_delete.html",GET_CAROUSEL_INFO:o+"i7391_CMS/carousel/carousel_edit.html?action=getCarouselInfo",GAME_LIST:o+"i7391_CMS/game/game_list.html",GAME_ADD:o+"i7391_CMS/game/game_add.html",GAME_EDIT:o+"i7391_CMS/game/game_edit.html",GAME_DELETE:o+"i7391_CMS/game/game_detele.html",GET_GAME_INFO:o+"i7391_CMS/game/game_edit.html?action=getGameInfo",POINTCARD_LIST:o+"i7391_CMS/pointcard/pointcard_list.html",POINTCARD_ADD:o+"i7391_CMS/pointcard/pointcard_add.html",POINTCARD_EDIT:o+"i7391_CMS/pointcard/pointcard_edit.html",POINTCARD_DELETE:o+"i7391_CMS/pointcard/pointcard_delete.html",GET_POINTCARD_INFO:o+"i7391_CMS/pointcard/pointcard_edit.html?action=getPointcardInfo",MOBILEGAME_LIST:o+"i7391_CMS/mobilegame/mobilegame_list.html",MOBILEGAME_ADD:o+"i7391_CMS/mobilegame/mobilegame_add.html",MOBILEGAME_EDIT:o+"i7391_CMS/mobilegame/mobilegame_edit.html",MOBILEGAME_DELETE:o+"i7391_CMS/mobilegame/mobilegame_delete.html",GET_MOBILEGAME_INFO:o+"i7391_CMS/mobilegame/mobilegame_edit.html?action=getMobileGameInfo",GOODS_LIST:o+"i7391_CMS/goods/goods_list.html",GOODS_ADD:o+"i7391_CMS/goods/goods_add.html",GOODS_EDIT:o+"i7391_CMS/goods/goods_edit.html",GOODS_DELETE:o+"i7391_CMS/goods/goods_detele.html",GET_GOODS_INFO:o+"i7391_CMS/goods/goods_edit.html?action=getGoodsInfo",GOODS_PC_LIST:o+"i7391_CMS/goods_pc/goods_list.html",GOODS_PC_ADD:o+"i7391_CMS/goods_pc/goods_add.html",GOODS_PC_EDIT:o+"i7391_CMS/goods_pc/goods_edit.html",GOODS_PC_DELETE:o+"i7391_CMS/goods_pc/goods_detele.html",GET_GOODS_PC_INFO:o+"i7391_CMS/goods_pc/goods_edit.html?action=getGoodsInfo",GET_RECORD:o+"8591/contrast/game_contrast.html?action=getRecord",GAME_CONTRAST:o+"8591/contrast/game_contrast.html",GET_ADDGAME_DATA:o+"i7391_API/getdata/get_allgame_data.html",GET_GAMETYPE_DATA:o+"i7391_API/getdata/get_gametype_data",GET_RATE:o+"i7391_API/getdata/get_rate.html",GET_CARD_CATEORY:o+"i7391_API/getdata/get_card_category.html",GET_CARD_POINT:o+"i7391_API/getdata/get_card_point.html"}}),define("config/function",["jquery","zui","config/config","config/cookie"],function(require,exports,module){"use strict";var n=require("jquery");require("zui");var t=require("config/config"),l=require("config/cookie");n.ajaxSetup({error:function(t,o,e){var n="介面出錯: "+t.status;n+="<br /> 介面: "+this.url,n+="<br /> 方式: "+this.type,n+="<br /> 資料: "+this.data,i.show(n)},beforeSend:function(t){n("#ajax_loading").removeClass("hidden").addClass("show")},complete:function(t,o){n("#ajax_loading").removeClass("show").addClass("hidden")}}),n(".nav").on("click","li",function(t){t.preventDefault()}),n(document).on("click","#checkAll",function(){var t=n(this).prop("checked");n(".che").prop("checked",t)}),n(document).on("click",".che",function(){n(".che").length==n(".che:checked").length?n("#checkAll").prop("checked",!0):n("#checkAll").prop("checked",!1)}),n(document).keydown(function(t){switch(t.keyCode){case 13:case 32:return!1}}),n(document).on("input porpertychange",'input[type="text"]',function(t){n(this).tooltip("destroy");var o=n('input[type="text"]');""==n(this).val()&&n(this).tooltip("show","請填寫"+n(this).next().html());for(var e=0;e<o.length;e++){if(""==o[e].value){n(".up").addClass("disabled");break}n(".up").removeClass("disabled")}});exports.show_picture_upload=function(){return'<div id="tableUploader" class="uploader"><div class="uploader-message text-center"><div class="content"></div><button type="button" class="close">×</button></div><table class="table table-bordered"><thead><tr><th colspan="2">檔名</th><th style="width: 100px">大小</th><th style="width: 160px; text-align: center;">狀態/操作</th></tr></thead><tbody class="uploader-files"><tr class="file template"><td style="width: 38px; padding: 3px"><div class="file-icon"></div></td><td style="padding: 0"><div style="position: relative; padding: 8px;"><strong class="file-name"></strong><div class="file-progress-bar"></div></div></td><td><span class="file-size text-muted"></span></td><td class="actions text-right" style="padding: 0 4px;"><div class="file-status" data-toggle="tooltip" style="margin: 8px;"><i class="icon"></i> <span class="text"></span></div><a data-toggle="tooltip" class="btn btn-link btn-download-file" target="_blank"><i class="icon icon-download-alt"></i></a><button type="button" data-toggle="tooltip" class="btn btn-link btn-reset-file" title="Repeat"><i class="icon icon-repeat"></i></button><button type="button" data-toggle="tooltip" class="btn btn-link btn-rename-file" title="Rename"><i class="icon icon-pencil"></i></button><button type="button" data-toggle="tooltip" title="Remove" class="btn btn-link btn-delete-file"><i class="icon icon-trash text-danger"></i></button></td></tr></tbody><tfoot><tr><td colspan="4" style="padding: 4px 0"><div style="position: relative;"><div class="uploader-status pull-right text-muted" style="margin-top: 5px;"></div><button type="button" class="btn btn-link uploader-btn-browse"><i class="icon icon-plus"></i> 選擇檔案</button><button type="button" class="btn btn-link uploader-btn-start"><i class="icon icon-cloud-upload"></i> 開始上傳</button></div></td></tr></tfoot></table></div>'};exports.show_upload_options=function(){n("#tableUploader").uploader({url:t.REQUEST_URL.UPLOAD,lang:"zh_tw",filters:{mime_types:[{title:"圖片",extensions:"jpg,gif,png"}]},limitFilesCount:1,deleteActionOnDone:function(t,o){o()},onFileUploaded:function(t,o){var e=JSON.parse(o.response);n("#imgUrlInput").val(e.data)}})};exports.show_picture_tooltip=function(){n(document).on("mouseover",".pic-show:not(:eq(0))",function(){n(this).tooltip("destroy");var t=n(this).html(),o=/^\/\//;!0===o.test(t)&&(t=t.replace(o,"http://"));var e="<img src="+t+' class="img-rounded">';n('[data-toggle="tooltip"]').tooltip({container:"#datagridPageExample",placement:"right",html:!0,title:e}),n(this).tooltip("show",e)})};var i=new n.zui.Messager("",{type:"danger",icon:"exclamation-sign",cssClass:"my-messager",contentClass:"my-messager-content",placement:"center",time:!0===seajs.data.debug?1e4:4e3});exports.get_user_i7391_cookie=function(t){var o=[],e=l("User_Cookie_Name");if(null===e||""===e)return!1;var n=e.split("&");for(var i in n){var a=n[i].split("=");o[a[0]]=a[1]}return void 0!==o[t]&&o[t]},exports.getUrlParam=function(t){var o=window.location.hash.match(new RegExp("(?:#|&)"+t+"=([^&]*)(&|$)"));return(o?decodeURIComponent(o[1]):"")||function(t,o){o||(o=window.location.href);t=t.replace(/[\[\]]/g,"\\$&");var e=new RegExp("[?&]"+t+"(=([^&#]*)|&|#|$)").exec(o);return e?e[2]?decodeURIComponent(e[2].replace(/\+/g," ")):"":null}(t)};exports.show_error_tip=function(t){var o=t;new n.zui.Messager({type:"danger",time:2e3,close:!1}).show(o)};exports.show_success_tip=function(t){var o=t;new n.zui.Messager({type:"success",time:2e3,close:!1}).show(o)}}),define("config/cookie",["jquery"],function(require,exports,module){"use strict";var p=require("jquery");module.exports=function(t,o,e){if(void 0===o){var n=null;if(document.cookie&&""!==document.cookie)for(var i=document.cookie.split(";"),a=0;a<i.length;a++){var l=p.trim(i[a]);if(l.substring(0,t.length+1)==t+"="){n=decodeURIComponent(l.substring(t.length+1));break}}return n}e=e||{},null===o&&(o="",e.expires=-1);var s,r="";e.expires&&("number"==typeof e.expires||e.expires.toUTCString)&&("number"==typeof e.expires?(s=new Date).setTime(s.getTime()+24*e.expires*60*60*1e3):s=e.expires,r="; expires="+s.toUTCString());var d=e.path?"; path="+e.path:"",c=e.domain?"; domain="+e.domain:"",u=e.secure?"; secure":"";document.cookie=[t,"=",encodeURIComponent(o),r,d,c,u].join("")}});