!function(a,t){"object"==typeof exports?module.exports=t():"function"==typeof define&&(define.amd||define.cmd)?define("config/zui.datatable.min",[],t):a.eventUtil=t()}(this,function(){!function(U){"use strict";var R="zui.datatable",B=U.zui.store,d=function(a,t){this.name=R,this.$=U(a),this.isTable="TABLE"===this.$[0].tagName,this.firstShow=!0,this.isTable?(this.$table=this.$,this.id="datatable-"+(this.$.attr("id")||U.zui.uuid())):(this.$datatable=this.$.addClass("datatable"),this.$.attr("id")?this.id=this.$.attr("id"):(this.id="datatable-"+U.zui.uuid(),this.$.attr("id",this.id))),this.getOptions(t),this.load(),this.callEvent("ready")};d.DEFAULTS={checkable:!1,checkByClickRow:!0,checkedClass:"active",checkboxName:null,selectable:!0,sortable:!1,storage:!0,fixedHeader:!1,fixedHeaderOffset:0,fixedLeftWidth:"30%",fixedRightWidth:"30%",flexHeadDrag:!0,scrollPos:"in",rowHover:!0,colHover:!0,hoverClass:"hover",colHoverClass:"col-hover",fixCellHeight:!0,mergeRows:!1,minColWidth:20,minFixedLeftWidth:200,minFixedRightWidth:200,minFlexAreaWidth:200},d.prototype.getOptions=function(e){var s=this.$;(e=U.extend({},d.DEFAULTS,this.$.data(),e)).tableClass=e.tableClass||"",e.tableClass=" "+e.tableClass+" table-datatable",U.each(["bordered","condensed","striped","condensed","fixed"],function(a,t){t="table-"+t,s.hasClass(t)&&(e.tableClass+=" "+t)}),(s.hasClass("table-hover")||e.rowHover)&&(e.tableClass+=" table-hover"),e.checkable&&U.fn.selectable||(e.selectable=!1),this.options=e},d.prototype.load=function(a){var t,e=this.options;if(U.isFunction(a))(a=a(this.data,this)).keepSort=!0;else if(U.isPlainObject(a))this.data=a;else if("string"==typeof a){var s=U(a);s.length&&(this.$table=s.first(),this.$table.data(R,this),this.isTable=!0),a=null}else a=e.data;if(!a){if(!this.isTable)throw new Error("No data avaliable!");t=(a={cols:[],rows:[]}).cols;var l,d,i,r,o,n=a.rows,c=this.$table;c.children("thead").children("tr:first").children("th").each(function(){l=U(this),t.push(U.extend({text:l.html(),flex:l.hasClass("flex-col"),width:"auto",cssClass:l.attr("class"),css:l.attr("style"),type:"string",ignore:l.hasClass("ignore"),sort:!l.hasClass("sort-disabled"),mergeRows:l.attr("merge-rows")},l.data()))}),c.children("tbody").children("tr").each(function(){d=U(this),r=U.extend({data:[],checked:!1,cssClass:d.attr("class"),css:d.attr("style"),id:d.attr("id")},d.data()),d.children("td").each(function(){if(i=U(this),o=i.attr("colspan")||1,r.data.push(U.extend({cssClass:i.attr("class"),css:i.attr("style"),text:i.html(),colSpan:o,title:i.attr("title")},i.data())),1<o)for(f=1;f<o;f++)r.data.push({empty:!0})}),n.push(r)});var h=c.children("tfoot");h.length&&(a.footer=U('<table class="table'+e.tableClass+'"></table>').append(h))}a.flexStart=-1,a.flexEnd=-1,t=a.cols,a.colsLength=t.length;for(var f=0;f<a.colsLength;++f){t[f].flex&&(a.flexStart<0&&(a.flexStart=f),a.flexEnd=f)}0===a.flexStart&&a.flexEnd===a.colsLength&&(a.flexStart=-1,a.flexEnd=-1),a.flexArea=0<=a.flexStart,a.fixedRight=0<=a.flexEnd&&a.flexEnd<a.colsLength-1,a.fixedLeft=0<a.flexStart,a.flexStart<0&&a.flexEnd<0&&(a.fixedLeft=!0,a.flexStart=a.colsLength,a.flexEnd=a.colsLength),this.data=a,this.callEvent("afterLoad",{data:a}),this.render()},d.prototype.render=function(){var a,t,e,s,l=this,d=l.$datatable||(l.isTable?U('<div class="datatable" id="'+l.id+'"/>'):l.$datatable),i=l.options,r=l.data,o=l.data.cols,n=l.data.rows,c=i.checkable,h='<div class="datatable-rows-span datatable-span"><div class="datatable-wrapper"><table class="table"></table></div></div>',f='<div class="datatable-head-span datatable-span"><div class="datatable-wrapper"><table class="table"><thead></thead></table></div></div>';d.children(".datatable-head, .datatable-rows, .scroll-wrapper").remove(),d.toggleClass("sortable",i.sortable);var p,b,g,w,u=U('<div class="datatable-head"/>');for(a=U('<tr class="datatable-row datatable-row-left"/>'),e=U('<tr class="datatable-row datatable-row-right"/>'),s=U('<tr class="datatable-row datatable-row-flex"/>'),t=0;t<o.length;t++)g=o[t],p=t<r.flexStart?a:t>=r.flexStart&&t<=r.flexEnd?s:e,0===t&&c&&p.append('<th data-index="check" class="check-all check-btn"><i class="icon-check-empty"></i></th>'),g.ignore||((b=U('<th class="datatable-head-cell"/>')).toggleClass("sort-down","down"===g.sort).toggleClass("sort-up","up"===g.sort).toggleClass("sort-disabled",!1===g.sort),b.addClass(g.cssClass).addClass(g.colClass).html(g.text).attr({"data-index":t,"data-type":g.type,style:g.css}).css("width",g.width),p.append(b));r.fixedLeft&&((w=U(f)).addClass("fixed-left").find("table").addClass(i.tableClass).find("thead").append(a),u.append(w)),r.flexArea&&((w=U(f)).addClass("flexarea").find(".datatable-wrapper").append('<div class="scrolled-shadow scrolled-in-shadow"></div><div class="scrolled-shadow scrolled-out-shadow"></div>').find("table").addClass(i.tableClass).find("thead").append(s),u.append(w)),r.fixedRight&&((w=U(f)).addClass("fixed-right").find("table").addClass(i.tableClass).find("thead").append(e),u.append(w)),d.append(u);var x,v,C,k,m,y,$,S,E,L=U('<div class="datatable-rows">'),H=n.length;a=U("<tbody/>"),e=U("<tbody/>"),s=U("<tbody/>");for(var A=0;A<H;++A){for(void 0===(y=n[A]).id&&(y.id=A),y.index=A,(x=U('<tr class="datatable-row"/>')).addClass(y.cssClass).toggleClass(i.checkedClass,!!y.checked).attr({"data-index":A,"data-id":y.id}),v=x.clone().addClass("datatable-row-flex"),C=x.clone().addClass("datatable-row-right"),x.addClass("datatable-row-left"),S=y.data.length,t=0;t<S;++t)$=y.data[t],0<t&&$.empty||(p=t<r.flexStart?x:t>=r.flexStart&&t<=r.flexEnd?v:C,0===t&&c&&(m=U('<td data-index="check" class="check-row check-btn"><i class="icon-check-empty"></i></td>'),i.checkboxName&&m.append('<input class="hide" type="checkbox" name="'+i.checkboxName+'" value="'+y.id+'">'),p.append(m)),o[t].ignore||(U.isPlainObject($)?($.row=A,$.index=t):$={text:$,row:A,index:t},y.data[t]=$,(k=U('<td class="datatable-cell"/>')).html($.text).addClass($.cssClass).addClass(o[t].colClass).attr("colspan",$.colSpan).attr({"data-row":A,"data-index":t,"data-flex":!1,"data-type":o[t].type,style:$.css,title:$.title||""}).css("width",o[t].width),p.append(k)));a.append(x),s.append(v),e.append(C)}r.fixedLeft&&((E=U(h)).addClass("fixed-left").find("table").addClass(i.tableClass).append(a),L.append(E)),r.flexArea&&((E=U(h)).addClass("flexarea").find(".datatable-wrapper").append('<div class="scrolled-shadow scrolled-in-shadow"></div><div class="scrolled-shadow scrolled-out-shadow"></div>').find("table").addClass(i.tableClass).append(s),L.append(E)),r.fixedRight&&((E=U(h)).addClass("fixed-right").find("table").addClass(i.tableClass).append(e),L.append(E)),d.append(L),r.flexArea&&d.append('<div class="scroll-wrapper"><div class="scroll-slide scroll-pos-'+i.scrollPos+'"><div class="bar"></div></div></div>');var z=d.children(".datatable-footer").detach();r.footer?(d.append(U('<div class="datatable-footer"/>').append(r.footer)),r.footer=null):z.length&&d.append(z),l.$datatable=d.data(R,l),l.isTable&&l.firstShow&&(l.$table.attr("data-datatable-id",this.id).hide().after(d),l.firstShow=!1),l.bindEvents(),l.refreshSize(),l.callEvent("render")},d.prototype.bindEvents=function(){var s=this,l=this.data,d=this.options,e=this.$datatable,a=s.$dataSpans=e.children(".datatable-head, .datatable-rows").find(".datatable-span"),i=s.$rowsSpans=e.children(".datatable-rows").children(".datatable-rows-span"),r=s.$headSpans=e.children(".datatable-head").children(".datatable-head-span"),t=s.$cells=a.find(".datatable-head-cell,.datatable-cell"),o=s.$dataCells=t.filter(".datatable-cell");s.$headCells=t.filter(".datatable-head-cell");var n=s.$rows=s.$rowsSpans.find(".datatable-row");if(d.rowHover){var c=d.hoverClass;i.on("mouseenter",".datatable-cell",function(){o.filter("."+c).removeClass(c),n.filter("."+c).removeClass(c),n.filter('[data-index="'+U(this).addClass(c).data("row")+'"]').addClass(c)}).on("mouseleave",".datatable-cell",function(){o.filter("."+c).removeClass(c),n.filter("."+c).removeClass(c)})}if(d.colHover){var h=d.colHoverClass;r.on("mouseenter",".datatable-head-cell",function(){t.filter("."+h).removeClass(h),t.filter('[data-index="'+U(this).data("index")+'"]').addClass(h)}).on("mouseleave",".datatable-head-cell",function(){t.filter("."+h).removeClass(h)})}if(l.flexArea){var f,p,b,g,w,u,x=e.find(".scroll-slide"),v=e.find(".datatable-span.flexarea"),C=e.find(".datatable-span.fixed-left"),k=e.find(".datatable-span.flexarea .table-datatable"),m=x.children(".bar"),y=s.id+"_scrollOffset";s.width=e.width(),e.resize(function(){s.width=e.width()});var $=function(a,t){g=Math.max(0,Math.min(f-p,a)),t||e.addClass("scrolling"),m.css("left",g),u=0-Math.floor((b-f)*g/(f-p)),k.css("left",u),g,e.toggleClass("scrolled-in",2<g).toggleClass("scrolled-out",g<f-p-2),d.storage&&B.pageSet(y,g)},S=function(){f=v.width(),x.width(f).css("left",C.width()),b=0,b=k.width(),p=Math.floor(f*f/b),m.css("width",p),k.css("min-width",f),e.toggleClass("show-scroll-slide",f<b),w||f===p||(w=!0,$(B.pageGet(y,0),!0)),e.hasClass("size-changing")&&$(g,!0)};v.resize(S),d.storage&&S();var E={move:!1,stopPropagation:!0,drag:function(a){$(m.position().left+a.smallOffset.x*(a.element.hasClass("bar")?1:-1))},finish:function(){e.removeClass("scrolling")}};U.fn.draggable?(m.draggable(E),d.flexHeadDrag&&e.find(".datatable-head-span.flexarea").draggable(E)):console.error("DataTable requires draggable.js to improve UI."),x.mousedown(function(a){var t=a.pageX-x.offset().left;$(t-p/2)})}if(d.checkable){var L,H=s.id+"_checkedStatus",A=d.checkedClass,z=function(){var a=i.first().find(".datatable-row"),t=a.filter("."+A);d.checkboxName&&a.find(".check-row input:checkbox").prop("checked",!1);var e={checkedAll:a.length===t.length&&0<t.length,checks:t.map(function(){return L=U(this).data("id"),d.checkboxName&&U(this).find(".check-row input:checkbox").prop("checked",!0),L}).toArray()};s.checks=e,U.each(l.rows,function(a,t){t.checked=-1<U.inArray(t.id,e.checks)}),r.find(".check-all").toggleClass("checked",!!e.checkedAll),d.storage&&B.pageSet(H,e),s.callEvent("checksChanged",{checks:e})},R=function(a,t){var e=U(a).closest("tr");void 0===t&&(t=!e.hasClass(A)),n.filter('[data-index="'+e.data("index")+'"]').toggleClass(A,!!t)},T="click.zui.datatable.check";if(d.selectable){var O={selector:".datatable-rows .datatable-row",trigger:".datatable-rows",start:function(a){var t=U(a.target).closest(".check-row, .check-btn");if(t.length)return t.is(".check-row")&&(R(t),z()),!1},rangeFunc:function(a,t){return Math.max(a.top,t.top)<Math.min(a.top+a.height,t.top+t.height)},select:function(a){R(a.target,!0)},unselect:function(a){R(a.target,!1)},finish:function(a){z()}};U.isPlainObject(d.selectable)&&U.extend(O,d.selectable),this.$datatable.selectable(O)}else this.$rowsSpans.off(T).on(T+"row",d.checkByClickRow?"tr":".check-row",function(){R(this),z()});if(this.$datatable.off(T).on("click.zui.datatable.check",".check-all",function(){n.toggleClass(A,U(this).toggleClass("checked").hasClass("checked")),z()}).on(T+".none",".check-none",function(){n.toggleClass(A,!1),z()}).on(T+".inverse",".check-inverse",function(){n.toggleClass(A),z()}),d.storage){var F=B.pageGet(H);F&&(r.find(".check-all").toggleClass("checked",F.checkedAll),F.checkedAll?n.addClass(A):(n.removeClass(A),U.each(F.checks,function(a,t){n.filter('[data-id="'+t+'"]').addClass(A)})),F.checks.length&&z())}}if(d.fixedHeader){var N,j,W,D=e.children(".datatable-head"),M=d.fixedHeaderOffset||U(".navbar.navbar-fixed-top").height()||0,P=function(){N=e.offset().top,W=U(window).scrollTop(),j=e.height(),e.toggleClass("head-fixed",N<W+M&&W+M<N+j),e.hasClass("head-fixed")?D.css({width:e.width(),top:M}):D.attr("style","")};U(window).scroll(P),P()}d.sortable?(r.on("click","th:not(.sort-disabled, .check-btn)",function(){e.hasClass("size-changing")||s.sortTable(U(this))}),d.storage&&s.sortTable()):d.mergeRows&&this.mergeRows()},d.prototype.mergeRows=function(){for(var a=this.$rowsSpans.find(".datatable-cell"),t=this.data.cols,e=0;e<t.length;e++){if(t[e].mergeRows){var s,l,d=a.filter('[data-index="'+e+'"]');if(1<d.length)d.each(function(){var a=U(this);s&&a.html()===s.html()?("number"!=typeof(l=s.attr("rowspan")||1)&&(l=parseInt(l),isNaN(l)&&(l=1)),s.attr("rowspan",l+1).css("vertical-align","middle"),a.remove()):s=a})}}},d.prototype.sortTable=function(a){var t=U.zui.store,e=this.options,s=this.id+"_datatableSorter",l=e.storage?t.pageGet(s):null;if(a||(a=l?this.$headCells.filter('[data-index="'+l.index+'"]').addClass("sort-"+("up"===l.type?"down":"up")):this.$headCells.filter(".sort-up, .sort-down").first()),a.length){var d,i,r,o=this.data,n=o.cols,c=o.rows,h=this.$headCells;d=!a.hasClass("sort-up"),o.keepSort&&(d=!d),o.keepSort=null,h.removeClass("sort-up sort-down"),a.addClass(d?"sort-up":"sort-down"),r=a.data("index"),U.each(n,function(a,t){a==r||"up"!==t.sort&&"down"!==t.sort?a==r&&(t.sort=d?"up":"down",i=t.type):t.sort=!0});var f,p,b,g=this.$dataCells.filter('[data-index="'+r+'"]');c.sort(function(a,t){return a=a.data[r],t=t.data[r],f=g.filter('[data-row="'+a.row+'"]').text(),p=g.filter('[data-row="'+t.row+'"]').text(),"number"===i?(f=parseFloat(f),p=parseFloat(p)):"date"===i?(f=Date.parse(f),p=Date.parse(p)):(f=f.toLowerCase(),p=p.toLowerCase()),b=f<p?1:p<f?-1:0,d&&(b*=-1),b});var w,u,x=this.$rows,v=[];U.each(c,function(a,t){x.filter('[data-index="'+t.index+'"]').each(function(a){u=U(this),(w=v[a])?w.after(u):u.parent().prepend(u),v[a]=u})}),l={index:r,type:d?"up":"down"},e.storage&&t.pageSet(s,l),this.callEvent("sort",{sorter:l})}},d.prototype.refreshSize=function(){var a,t=this.$datatable,e=this.options,s=this.data.rows;if(this.data.cols,t.find(".datatable-span.fixed-left").css("width",e.fixedLeftWidth),t.find(".datatable-span.fixed-right").css("width",e.fixedRightWidth),e.fixCellHeight){var l,d=function(a){var t,e,s=0;return a.css("height","auto"),a.each(function(){t=U(this),(e=t.attr("rowspan"))&&1!=e||(s=Math.max(s,t.outerHeight()))}),s},i=this.$dataCells,r=(this.$cells,this.$headCells),o=d(r);for(r.css("min-height",o).css("height",o),a=0;a<s.length;++a){var n=d(l=i.filter('[data-row="'+a+'"]'));l.css("min-height",n).css("height",n)}}},d.prototype.callEvent=function(a,t){var e=this.$.callEvent(a+"."+this.name,t,this).result;return!(void 0!==e&&!e)},U.fn.datatable=function(s,l){return this.each(function(){var a=U(this),t=a.data(R),e="object"==typeof s&&s;t||a.data(R,t=new d(this,e)),"string"==typeof s&&("load"!==s||!U.isPlainObject(l)||void 0!==l.keepSort&&null!==l.keepSort||(l.keepSort=!0),t[s](l))})},U.fn.datatable.Constructor=d}(jQuery)});