!function(e,t){"object"==typeof exports?module.exports=t():"function"==typeof define&&(define.amd||define.cmd)?define("config/zui.tabs.min",[],t):e.eventUtil=t()}(this,function(){!function(c){"use strict";var l=function(e){var t=this;"string"==typeof e?t.url=e:c.isPlainObject(e)&&c.extend(t,e),t.id||(t.id=c.zui.uuid()),t.type||(t.iframe?(t.type="iframe",t.url=t.url||t.iframe):t.ajax?(t.type="ajax",t.url=t.url||(c.isPlainObject(t.ajax)?t.ajax.url:t.ajax)):t.url?t.type=e.ajax?"ajax":"iframe":t.type="custom"),t.createTime=(new Date).getTime(),t.openTime=0,t.onCreate&&t.onCreate.call(t)};l.prototype.open=function(){var e=this;e.openTime=(new Date).getTime(),e.onOpen&&e.onOpen.call(e)},l.prototype.close=function(){var e=this;e.openTime=0,e.onClose&&e.onClose.call(e)},l.create=function(e){return e instanceof l?e:new l(e)};var d="zui.tabs",v={tabs:[],defaultTabIcon:"icon-window",contextMenu:!0,errorTemplate:'<div class="alert alert-block alert-danger with-icon"><i class="icon-warning-sign"></i><div class="content">{0}</div></div>',showMessage:!0,navTemplate:'<nav class="tabs-navbar"></nav>',containerTemplate:'<div class="tabs-container"></div>'},p={zh_cn:{reload:"重新加载",close:"关闭",closeOthers:"关闭其他标签页",closeRight:"关闭右侧标签页",reopenLast:"恢复上次关闭的标签页",errorCannotFetchFromRemote:"无法从远程服务器（{0}）获取内容。"},zh_tw:{reload:"重新加載",close:"關閉",closeOthers:"關閉其他標籤頁",closeRight:"關閉右側標籤頁",reopenLast:"恢復上次關閉的標籤頁",errorCannotFetchFromRemote:"無法從遠程服務器（{0}）獲取內容。"},en:{reload:"Reload",close:"Close",closeOthers:"Close others",closeRight:"Close right",reopenLast:"Reopen last",errorCannotFetchFromRemote:"Cannot fetch data from remote server {0}."}},o=function(e,t){var n=this;n.name=d,n.$=c(e);var a=(t=n.options=c.extend({},v,this.$.data(),t)).lang||"zh_cn";n.lang=c.isPlainObject(a)?c.extend(!0,{},p[a.lang||c.zui.clientLang()],a):p[a];var o=n.$.find(".tabs-navbar");o.length||(o=c(t.navTemplate).appendTo(n.$));var i=(n.$navbar=o).find(".tabs-nav");i.length||(i=c('<ul class="tabs-nav nav nav-tabs"></ul>').appendTo(o)),n.$nav=i;var s=n.$.find(".tabs-container");s.length||(s=c(t.containerTemplate).appendTo(n.$)),n.$tabs=s,n.activeTabId=t.defaultTab;var r=t.tabs||[];n.tabs={},c.each(r,function(e,t){var a=l.create(t);n.tabs[a.id]=a,n.activeTabId||(n.activeTabId=a.id),n.renderTab(a)}),n.closedTabs=[],n.open(n.getActiveTab()),i.on("click."+d,".tab-nav-link",function(){n.open(n.getTab(c(this).data("id")))}).on("click."+d,".tab-nav-close",function(e){n.close(c(this).closest(".tab-nav-link").data("id")),e.stopPropagation()}).on("resize."+d,function(){n.adjustNavs()}),t.contextMenu&&i.contextmenu({selector:".tab-nav-link",itemsCreator:function(e){return n.createMenuItems(n.getTab(c(this).data("id")))},onShow:function(){n.$.addClass("tabs-show-contextmenu")},onHide:function(){n.$.removeClass("tabs-show-contextmenu")}})};o.prototype.createMenuItems=function(e){var t=this,a=t.lang;return[{label:a.reload,onClick:function(){t.open(e,!0)}},"-",{label:a.close,disabled:e.forbidClose,onClick:function(){t.close(e.id)}},{label:a.closeOthers,disabled:t.$nav.find(".tab-nav-item:not(.hidden)").length<=1,onClick:function(){t.closeOthers(e.id)}},{label:a.closeRight,disabled:!c("#tab-nav-item-"+e.id).next(".tab-nav-item:not(.hidden)").length,onClick:function(){t.closeRight(e.id)}},"-",{label:a.reopenLast,disabled:!t.closedTabs.length,onClick:function(){t.reopen()}}]},o.prototype.adjustNavs=function(e){var t=this;if(!e)return t.adjustNavsTimer&&clearTimeout(t.adjustNavsTimer),void(t.adjustNavsTimer=setTimeout(function(){t.adjustNavs(!0)},50));t.adjustNavsTimer&&(t.adjustNavsTimer=null);var a=t.$nav,n=a.find(".tab-nav-item:not(.hidden)"),o=a.width(),i=n.length,s=Math.floor(o/i);s<96&&(s=Math.floor((o-96)/(i-1))),a.toggleClass("tab-nav-condensed",s<=50),n.css("max-width",s)},o.prototype.renderTab=function(e,t){var a=this,n=(a.$nav,c("#tab-nav-item-"+e.id));if(!n.length){var o=c('<a class="tab-nav-link"><i class="icon"></i><span class="title"></span><i class="close tab-nav-close" title="'+a.lang.close+'">&times;</i></a>').attr({href:"#tabs-item-"+e.id,"data-id":e.id});if(n=c('<li class="tab-nav-item" data-id="'+e.id+'" id="tab-nav-item-'+e.id+'" />').append(o).appendTo(a.$nav),t){var i=c("#tab-nav-item-"+t);i.length&&n.insertAfter(i)}a.adjustNavs()}return(o=n.find("a").attr("title",e.desc).toggleClass("not-closable",!!e.forbidClose)).find(".icon").attr("class","icon "+(e.icon||a.options.defaultTabIcon)),o.find(".title").text(e.title||e.defaultTitle||""),n},o.prototype.getActiveTab=function(){var e=this;return e.activeTabId?e.tabs[e.activeTabId]:null},o.prototype.getTab=function(e){return e?("object"==typeof e&&(e=e.id),this.tabs[e]):this.getActiveTab()},o.prototype.close=function(e,t){var a,n=this,o=n.getTab(e);!o||!t&&o.forbidClose||(c("#tab-nav-item-"+o.id).remove(),c("#tab-"+o.id).remove(),o.close(),delete n.tabs[o.id],n.closedTabs.push(o),n.$.callComEvent(n,"onClose",o),c.each(n.tabs,function(e,t){(!a||a.openTime<t.openTime)&&(a=t)}),a&&n.open(a))},o.prototype.open=function(e,t){var a=this;e instanceof l||(e=l.create(e));var n=a.renderTab(e);a.$nav.find(".tab-nav-item.active").removeClass("active"),n.addClass("active");var o=c("#tab-"+e.id);o.length||(o=c('<div class="tab-pane" id="tab-'+e.id+'" />').appendTo(a.$tabs)),a.$tabs.find(".tab-pane.active").removeClass("active"),o.addClass("active"),e.open(),a.activeTabId=e.id,a.tabs[e.id]=e,!t&&e.loaded||a.reload(e),a.$.callComEvent(a,"onOpen",e)},o.prototype.showMessage=function(e,t){c.zui.messager.show(e,c.extend({placement:"center"},this.options.messagerOptions,{type:t}))},o.prototype.reload=function(n){var o=this;if("string"==typeof n?n=o.getTab(n):n||(n=o.getActiveTab()),n){if(!n.openTime)return o.open(n);var i=c("#tab-nav-item-"+n.id).addClass("loading").removeClass("has-error"),s=c("#tab-"+n.id).addClass("loading").removeClass("has-error"),r=function(e,t){if(n.openTime){if(i.removeClass("loading"),s.removeClass("loading"),o.$.callComEvent(o,"onLoad",n),("string"==typeof e||e instanceof c)&&(n.contentConverter&&(e=n.contentConverter(e,n)),s.empty().append(e),n.title||(e=s.text().replace(/\n/g,""),n.title=10<e.length?e.substr(0,10):e,o.renderTab(n))),t){i.addClass("has-error"),s.addClass("has-error");var a=o.options.showMessage;a&&(c.isFunction(a)&&(t=a(t)),o.showMessage(t,"danger")),e||s.html(o.options.errorTemplate.format(t))}n.loaded=(new Date).getTime()}};if("ajax"===n.type){var e={type:"get",url:n.url,error:function(e,t,a){r(!1,o.lang.errorCannotFetchFromRemote.format(n.url))},success:function(e){r(e)}};c.isPlainObject(n.ajax)&&(e=c.extend(e,n.ajax)),c.ajax(e)}else if("iframe"===n.type)try{var t="tab-iframe-"+n.id;c('<iframe id="'+t+'" name="'+t+'" src="'+n.url+'" frameborder="no"  allowfullscreen="true" mozallowfullscreen="true" webkitallowfullscreen="true"  allowtransparency="true" scrolling="auto" style="width: 100%; height: 100%; left: 0px;"></iframe>').appendTo(s.empty()),c('<div class="tab-iframe-cover" />').appendTo(s);var a=document.getElementById(t);a.onload=a.onreadystatechange=function(){if(!this.readyState||"complete"==this.readyState){r();var e=a.contentDocument;e&&!n.title&&(n.title=e.title,o.renderTab(n))}}}catch(e){r()}else{var l=n.content||n.custom;"function"==typeof l?!0!==(l=l(n,r,o))&&r(l):r(l)}}},o.prototype.closeOthers=function(t){var a=this;a.$nav.find(".tab-nav-link:not(.hidden)").each(function(){var e=c(this).data("id");e!==t&&a.close(e)})},o.prototype.closeRight=function(e){for(var t=c("#tab-nav-item-"+e),a=t.next(".tab-nav-item:not(.hidden)");a.length;)this.close(a.data("id")),a=t.next(".tab-nav-item:not(.hidden)")},o.prototype.closeAll=function(){var e=this;e.$nav.find(".tab-nav-link:not(.hidden)").each(function(){e.close(c(this).data("id"))})},o.prototype.reopen=function(){this.closedTabs.length&&this.open(this.closedTabs.pop())},c.fn.tabs=function(n){return this.each(function(){var e=c(this),t=e.data(d),a="object"==typeof n&&n;t||e.data(d,t=new o(this,a)),"string"==typeof n&&t[n]()})},o.NAME=d,c.fn.tabs.Constructor=o}(jQuery)});